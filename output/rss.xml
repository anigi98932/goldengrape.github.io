<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>GoldenGrape's Blog</title><link>https://goldengrape.github.io/</link><description>This is a blog site for GoldenGrape.</description><atom:link href="https://goldengrape.github.io/rss.xml" rel="self" type="application/rss+xml"></atom:link><language>zh_cn</language><copyright>Contents © 2018 &lt;a href="mailto:https://twitter.com/goldengrape"&gt;Golden Grape&lt;/a&gt; </copyright><lastBuildDate>Wed, 17 Oct 2018 06:12:00 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>DIY眼底照相机</title><link>https://goldengrape.github.io/posts/ophthalmology/DIY-fundus-camera/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;实际拍摄效果是这样的:
&lt;img alt="16" src="https://i.loli.net/2018/10/17/5bc6c829cdbdd.jpg"&gt;&lt;/p&gt;
&lt;p&gt;制作难度小学手工级. 请看视频教程:&lt;/p&gt;
&lt;iframe src="//player.bilibili.com/player.html?aid=34023057&amp;amp;cid=59587011&amp;amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"&gt; &lt;/iframe&gt;

&lt;p&gt;下面是图文教程:
&lt;!-- TEASER_END --&gt;&lt;/p&gt;
&lt;h2&gt;材料:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;无糖雪碧瓶(纤维+和零卡都可以): 其他种类的瓶子不好用, 无糖雪碧瓶是因为有向内的凸起, 能够固定住镜头.&lt;/li&gt;
&lt;li&gt;20D lens: 这是眼科医生专用的Volk Lens, 非球面, 20D, 其中一面更加凸起. 也许以后可以在淘宝上找些简单便宜的镜头, 但固定会是个问题.&lt;/li&gt;
&lt;li&gt;有闪光灯可拍照的手机: 理论上照明光路应当尽量拍摄光轴同轴, 也就是闪光灯要尽量与摄像头靠近. 但实测发现iPhone X这种离得非常近的反而有较大的lens反光, 本例中使用的是Lumia 640, 闪光灯与摄像头之间有10mm的间距反而效果更好.&lt;/li&gt;
&lt;li&gt;手机望远镜夹子: 淘宝以“望远镜显微镜 手机 夹子”为关键词即可搜到. 注意要是那种能够同时暴露出闪光灯和摄像头的, 淘宝有种是圆孔形状的, 不可用. 推荐使用我图中展示的这种, 结实方便, 但需要手机背面是光滑平整的, 这样才能被吸盘吸住.&lt;/li&gt;
&lt;li&gt;斜口钳, 剪刀&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;方法:&lt;/h2&gt;
&lt;h3&gt;剪掉瓶口边缘的棱&lt;/h3&gt;
&lt;p&gt;&lt;img alt="03" src="https://i.loli.net/2018/10/17/5bc6c89775806.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;剪掉最下一圈凸起&lt;/h3&gt;
&lt;p&gt;&lt;img alt="04" src="https://i.loli.net/2018/10/17/5bc6c82d27c40.jpg"&gt;
&lt;img alt="05" src="https://i.loli.net/2018/10/17/5bc6c88af1ffc.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;剪掉两个凸起&lt;/h3&gt;
&lt;p&gt;&lt;img alt="06" src="https://i.loli.net/2018/10/17/5bc6c88593469.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;瓶子转180度, 剪掉相对的两个凸起&lt;/h3&gt;
&lt;p&gt;&lt;img alt="07" src="https://i.loli.net/2018/10/17/5bc6c88c90ca7.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;修剪边缘&lt;/h3&gt;
&lt;p&gt;&lt;img alt="08" src="https://i.loli.net/2018/10/17/5bc6c88d83561.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;把20D lens卡住&lt;/h3&gt;
&lt;p&gt;&lt;img alt="09" src="https://i.loli.net/2018/10/17/5bc6c831ab22a.jpg"&gt;
之前剪掉凸起的动作, 是为了能够好安装, 好取出.&lt;/p&gt;
&lt;h3&gt;用手机望远镜夹子夹住&lt;/h3&gt;
&lt;p&gt;&lt;img alt="10" src="https://i.loli.net/2018/10/17/5bc6c830b5033.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;瓶口覆盖住摄像头和闪光灯, 固定&lt;/h3&gt;
&lt;p&gt;&lt;img alt="11" src="https://i.loli.net/2018/10/17/5bc6c8300f0e0.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;打开相机app, 使用录像模式, 开启闪光灯&lt;/h3&gt;
&lt;p&gt;&lt;img alt="12" src="https://i.loli.net/2018/10/17/5bc6c82a280a7.jpg"&gt;
&lt;img alt="13" src="https://i.loli.net/2018/10/17/5bc6c8313adfd.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;可选的改进, 用喷漆把瓶子喷成黑色&lt;/h3&gt;
&lt;p&gt;&lt;img alt="14" src="https://i.loli.net/2018/10/17/5bc6c8732a571.jpg"&gt;
&lt;img alt="15" src="https://i.loli.net/2018/10/17/5bc6c82e10d76.jpg"&gt;
但实测下来, 即使喷成黑色, 也仍然有比较明显的lens反光, 实际上是20D lens反光以后, 到瓶身发生了二次散射被相机记录下来, 这大概是使用瓶子作为固定装置的固有缺陷. 如果很想去除的话, 可以在瓶子内部一条一条粘贴黑色绒布.&lt;/p&gt;
&lt;h2&gt;结果:&lt;/h2&gt;
&lt;p&gt;&lt;img alt="16" src="https://i.loli.net/2018/10/17/5bc6c829cdbdd.jpg"&gt;
照片要从视频中截图.&lt;/p&gt;
&lt;h2&gt;讨论:&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;其实直接手持20D lens和手机, 也可以完成眼底照相(参考文献1), 缺点是容易手忙脚乱. 因为要撑开眼睑, 同时控制照明/拍摄/20D lens三者的光轴同轴, 操作还是比较困难.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;请想好如何向病人解释, 为何用一个雪碧瓶子对着他/她照相.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;雪碧瓶可能造成二次反光, 镜头反光可能扩展成圆环, 改进方法可以使用喷漆喷成黑色或者内部贴黑色绒布. 但改进效果有限. 有可能加入偏振片效果会更好.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;有文献建议在闪光灯前贴一个半透明胶布使照明光弥散(参考文献1). 实测意义不大.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;可能需要手动对焦和单独设定白平衡/亮度等, 有文献推荐使用FilMiC专业版进行拍摄.(参考文献2)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;网上亦有&lt;a href="http://www.odocs-tech.com"&gt;oDocs&lt;/a&gt;公司提供的&lt;a href="https://github.com/oDocsOphthalmicVision/odocsfundus"&gt;开源项目&lt;/a&gt; 只需下载文件, 到淘宝上找3D打印店打印然后装配即可.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;参考文献&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Smartphone Fundus Photography, J Vis Exp. 2017; (125): 55958. Published online 2017 Jul 6.   
有&lt;a href="https://www.jove.com/video/55958/smartphone-fundus-photography"&gt;视频讲解:&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Haddock LJ, Kim DY, Mukai S. Simple, inexpensive technique for high-quality smartphone fundus photography in human and animal eyes. J Ophthalmol 2013. 2013:518479.&lt;/li&gt;
&lt;/ol&gt;&lt;/div&gt;</description><category>ophthalmology</category><guid>https://goldengrape.github.io/posts/ophthalmology/DIY-fundus-camera/</guid><pubDate>Wed, 17 Oct 2018 04:00:00 GMT</pubDate></item><item><title>Alpha的后验分解</title><link>https://goldengrape.github.io/posts/python/Alpha_tear/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div tabindex="-1" id="notebook" class="border-box-sizing"&gt;
    &lt;div class="container" id="notebook-container"&gt;

&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="Alpha的后验分解"&gt;Alpha的后验分解&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#Alpha%E7%9A%84%E5%90%8E%E9%AA%8C%E5%88%86%E8%A7%A3"&gt;¶&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;最近在学习量化分析, 其中有一个作业是这样:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Alpha的后验分解：给定一个组合P，估算该组合相对于业绩基准组合B的各参数：$β_p$ 、$α_p$、 以及组合风险 $σ_p$ 和残差风险 $ω_p$&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;总觉得自己哪里算错了, 比如&lt;a href="http://cn.morningstar.com/quicktake/F0000003X3"&gt;华夏上证50ETF(代码: 510050)&lt;/a&gt;的alpha算出来总是-0.00091,&lt;/p&gt;
&lt;p&gt;一时检查不出来, 暂时先摆出来供讨论
&lt;!-- TEASER_END --&gt;&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [1]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;tushare&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;ts&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="设定目标"&gt;设定目标&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E8%AE%BE%E5%AE%9A%E7%9B%AE%E6%A0%87"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [2]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"510050.XSHG"&lt;/span&gt; &lt;span class="c1"&gt;# 华夏上证50&lt;/span&gt;
&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"000300.XSHG"&lt;/span&gt; &lt;span class="c1"&gt;# 沪深300指数&lt;/span&gt;
&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"2015-1-1"&lt;/span&gt;
&lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"2018-9-1"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="获得历史价格"&gt;获得历史价格&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E8%8E%B7%E5%BE%97%E5%8E%86%E5%8F%B2%E4%BB%B7%E6%A0%BC"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [3]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 如果有基金净值数据, 不能使用get_price取得, 因此分别提取数据&lt;/span&gt;
&lt;span class="n"&gt;p_target&lt;/span&gt;   &lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_price&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;   &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"close"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;p_benchmark&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_price&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;start_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"close"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [4]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 为避免投资组合的净值(价格)采样时间与基准的采样时间不同, 取两者的交集&lt;/span&gt;
&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;concat&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;p_target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;p_benchmark&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;axis&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;join&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'inner'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="c1"&gt;# 通过ts获取基金净值的时间顺序, 与通过ts获取股票价格的时间顺序, 这两者可能不同, 因此统一到时间降序上&lt;/span&gt;
&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ascending&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;inplace&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[4]:&lt;/div&gt;



&lt;div class="output_html rendered_html output_subarea output_execute_result"&gt;
&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;510050.XSHG&lt;/th&gt;
      &lt;th&gt;000300.XSHG&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;date&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-31&lt;/th&gt;
      &lt;td&gt;2.521&lt;/td&gt;
      &lt;td&gt;3334.5036&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-30&lt;/th&gt;
      &lt;td&gt;2.533&lt;/td&gt;
      &lt;td&gt;3351.0942&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-29&lt;/th&gt;
      &lt;td&gt;2.553&lt;/td&gt;
      &lt;td&gt;3386.5736&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-28&lt;/th&gt;
      &lt;td&gt;2.560&lt;/td&gt;
      &lt;td&gt;3400.1705&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-27&lt;/th&gt;
      &lt;td&gt;2.571&lt;/td&gt;
      &lt;td&gt;3406.5735&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [5]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 前一个交易日价格&lt;/span&gt;
&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shift&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[5]:&lt;/div&gt;



&lt;div class="output_html rendered_html output_subarea output_execute_result"&gt;
&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;510050.XSHG&lt;/th&gt;
      &lt;th&gt;000300.XSHG&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;date&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-31&lt;/th&gt;
      &lt;td&gt;2.533&lt;/td&gt;
      &lt;td&gt;3351.0942&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-30&lt;/th&gt;
      &lt;td&gt;2.553&lt;/td&gt;
      &lt;td&gt;3386.5736&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-29&lt;/th&gt;
      &lt;td&gt;2.560&lt;/td&gt;
      &lt;td&gt;3400.1705&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-28&lt;/th&gt;
      &lt;td&gt;2.571&lt;/td&gt;
      &lt;td&gt;3406.5735&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-27&lt;/th&gt;
      &lt;td&gt;2.523&lt;/td&gt;
      &lt;td&gt;3325.3347&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="计算收益率"&gt;计算收益率&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E8%AE%A1%E7%AE%97%E6%94%B6%E7%9B%8A%E7%8E%87"&gt;¶&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;每日收益率: 通过投资组合权益计算出的日收益率。&lt;/p&gt;
&lt;p&gt;$$
每日收益率=\frac{当前交易日总权益-前一交易日总权益}{前一交易日总权益}
$$&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [6]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shift&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;price&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shift&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drop&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;inplace&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# last row is NaN, I think it should be droped&lt;/span&gt;
&lt;span class="c1"&gt;# 取得中债国债收益率曲线作为无风险收益率&lt;/span&gt;
&lt;span class="n"&gt;r_riskfree&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;get_yield_curve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;start_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;end_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tenor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'0S'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;r_riskfree&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;left_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;right_index&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;how&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"inner"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"riskfree"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[6]:&lt;/div&gt;



&lt;div class="output_html rendered_html output_subarea output_execute_result"&gt;
&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;510050.XSHG&lt;/th&gt;
      &lt;th&gt;000300.XSHG&lt;/th&gt;
      &lt;th&gt;riskfree&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-31&lt;/th&gt;
      &lt;td&gt;-0.004737&lt;/td&gt;
      &lt;td&gt;-0.004951&lt;/td&gt;
      &lt;td&gt;0.018291&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-30&lt;/th&gt;
      &lt;td&gt;-0.007834&lt;/td&gt;
      &lt;td&gt;-0.010476&lt;/td&gt;
      &lt;td&gt;0.017971&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-29&lt;/th&gt;
      &lt;td&gt;-0.002734&lt;/td&gt;
      &lt;td&gt;-0.003999&lt;/td&gt;
      &lt;td&gt;0.019096&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-28&lt;/th&gt;
      &lt;td&gt;-0.004278&lt;/td&gt;
      &lt;td&gt;-0.001880&lt;/td&gt;
      &lt;td&gt;0.018622&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2018-08-27&lt;/th&gt;
      &lt;td&gt;0.019025&lt;/td&gt;
      &lt;td&gt;0.024430&lt;/td&gt;
      &lt;td&gt;0.018767&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="计算$\beta$"&gt;计算$\beta$&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E8%AE%A1%E7%AE%97%24%5Cbeta%24"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;p&gt;计算方法参考&lt;a href="https://www.ricequant.com/api/python/chn#backtest-results-factors"&gt;RiceQuant API文档&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;贝塔(beta, $\beta$ ): &lt;a href="https://en.wikipedia.org/wiki/Capital_asset_pricing_model"&gt;CAPM&lt;/a&gt;模型中市场基准组合项的系数，表示资产收益对市场整体收益波动的敏感程度。
 $$
 \beta=\frac{Cov(r_{p,e}, r_{b,e})}{Var(r_{b,e})}
 $$&lt;/p&gt;
&lt;p&gt;其中$r_{p,e}$为策略超额收益率（策略收益率 - 无风险组合收益率）；$r_{b,e}$为市场基准组合超额收益率（市场基准组合收益率 - 无风险组合收益率）；Cov 表示协方差；Var 表示方差&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;注意: numpy中, np.cov(a,b)的计算结果是$2\times2$矩阵
$$
np.cov(a,b)=\left[ \begin{array}{cc} cov\left( a,\; a \right) &amp;amp; cov\left( a,\; b \right) \\ cov\left( a,\; b \right) &amp;amp; cov\left( b,\; b \right) \end{array} \right]
$$&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [7]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;r_pe&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"riskfree"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;r_be&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"riskfree"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;beta&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cov&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r_pe&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;r_be&lt;/span&gt;&lt;span class="p"&gt;)[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r_be&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;beta&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[7]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;0.9511718021320907&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="求解$\alpha$"&gt;求解$\alpha$&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E6%B1%82%E8%A7%A3%24%5Calpha%24"&gt;¶&lt;/a&gt;&lt;/h2&gt;&lt;h3 id="方法1"&gt;方法1&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E6%96%B9%E6%B3%951"&gt;¶&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;计算方法参考&lt;a href="https://www.ricequant.com/api/python/chn#backtest-results-factors"&gt;RiceQuant API文档&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;阿尔法(alpha, $\alpha$): &lt;a href="https://en.wikipedia.org/wiki/Capital_asset_pricing_model"&gt;CAPM&lt;/a&gt;模型表达式中的残余项。表示策略所持有投资组合的收益中和市场整体收益无关的部分，是策略选股能力的度量。当策略所选股票的总体表现优于市场基准组合成分股时，阿尔法取正值；反之取负值。
$$
\alpha=E[r_p-[r_f+\beta \times (r_b-r_f)]]
$$&lt;/p&gt;
&lt;p&gt;其中$r_p$为策略所持有投资组合收益；$r_f$为无风险组合收益；$\beta$为CAPM模型中的贝塔系数；E表示随机变量的期望。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [8]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"riskfree"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;beta&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"riskfree"&lt;/span&gt;&lt;span class="p"&gt;])))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;alpha&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[8]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;-0.00091193563738157&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="方法2"&gt;方法2&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E6%96%B9%E6%B3%952"&gt;¶&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;$$
\theta_p(t)= \alpha_p+ \epsilon(t)
\\
E[r_p(t)] = \beta_p E[r_B(t)] + E[\theta_p(t)]
\\
\alpha_p=E[\theta_p(t)]
\\
\alpha_p=E[r_p(t)]-\beta_p E[r_B(t)]
$$&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [9]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r_pe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;beta&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;r_be&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[9]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;-0.0009119356373815703&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="求解投资组合风险-$\sigma_p$"&gt;求解投资组合风险 $\sigma_p$&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E6%B1%82%E8%A7%A3%E6%8A%95%E8%B5%84%E7%BB%84%E5%90%88%E9%A3%8E%E9%99%A9-%24%5Csigma_p%24"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [10]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;sigma_p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;sigma_p&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[10]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;0.01640696817905404&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="求解残差风险-$\omega_p$"&gt;求解残差风险 $\omega_p$&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E6%B1%82%E8%A7%A3%E6%AE%8B%E5%B7%AE%E9%A3%8E%E9%99%A9-%24%5Comega_p%24"&gt;¶&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;$$
\omega _{p}=\; \sqrt{\sigma _{p}^{2}-\beta _{p}^{2}\cdot \sigma _{B}^{2}\; }
$$&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [11]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;omega_p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sigma_p&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;beta&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;omega_p&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[11]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;0.005885928156058898&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="年化"&gt;年化&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E5%B9%B4%E5%8C%96"&gt;¶&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;这里假设一年有244个交易日。&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [12]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;day_count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;get_trading_dates&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;start_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;end_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;end&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;annual_correct&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;244&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;day_count&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;annual_sigma_p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;annual_correct&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;sigma_p&lt;/span&gt;
&lt;span class="n"&gt;annual_omega_p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;annual_correct&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;omega_p&lt;/span&gt;
&lt;span class="n"&gt;annual_sigma_p&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;omega_p&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[12]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;(0.008566663958171634, 0.005885928156058898)&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h2 id="RiceQuant上其他一些指标"&gt;RiceQuant上其他一些指标&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#RiceQuant%E4%B8%8A%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E6%8C%87%E6%A0%87"&gt;¶&lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="年化波动率(volatility,-$\sigma_t$):"&gt;年化波动率(volatility, $\sigma_t$):&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E5%B9%B4%E5%8C%96%E6%B3%A2%E5%8A%A8%E7%8E%87(volatility,-%24%5Csigma_t%24):"&gt;¶&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;策略收益率的标准差，最常用的风险度量。波动率越大，策略承担的风险越高。这里假设一年有244个交易日。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;$$
\sigma =\sqrt{\frac{244}{n-1}\sum_{i=1}^{n}{\left[ r_{p}\left( i \right)\; -\; \bar{r_{p}} \right]^{2}}}
$$&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;其中，n为回测期内交易日数目；$r_p(i)$ 表示第 i 个交易日策略所持有投资组合的日收益率；$ \bar{r_p} $ 为回测期内策略日收益率的均值。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [13]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;volatility&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;244&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;day_count&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="c1"&gt;# 定义与年化投资组合风险sigma_p一致&lt;/span&gt;
&lt;span class="n"&gt;volatility&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[13]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;0.008566663958171633&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="年化跟踪误差(tracking-error,$\sigma_t$-):"&gt;年化跟踪误差(tracking error,$\sigma_t$ ):&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E5%B9%B4%E5%8C%96%E8%B7%9F%E8%B8%AA%E8%AF%AF%E5%B7%AE(tracking-error,%24%5Csigma_t%24-):"&gt;¶&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;纯多头主动交易策略（阿尔法策略和基准择时策略）收益和市场基准组合收益之间差异的度量。跟踪误差越大，意味着策略所持有投资组合偏离基准组合的程度越大。需要注意，跟踪误差不适用于多-空结合的对冲策略的风险评估&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;$$
\sigma =\sqrt{\frac{244}{n-1}\sum_{i=1}^{n}{\left[ r_{pa}\left( i \right)\; -\; \bar{r_{pa}} \right]^{2}}}
\\
r_{pa}(i)=r_p(i)-r_b(i)
$$
其中，n为回测期内交易日数量；$r_{pa}(i), r_p(i), r_b(i)$分别表示第i个交易日策略所持有投资组合的日主动收益、日收益率和基准组合的日收益率。&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [14]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;tracking_error&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;244&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;day_count&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r_pe&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;std&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;span class="n"&gt;tracking_error&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[14]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;0.5218443423891064&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="年化下行波动率(downside-risk,-$\sigma_d$):"&gt;年化下行波动率(downside risk, $\sigma_d$):&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E5%B9%B4%E5%8C%96%E4%B8%8B%E8%A1%8C%E6%B3%A2%E5%8A%A8%E7%8E%87(downside-risk,-%24%5Csigma_d%24):"&gt;¶&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;相比波动率，下行波动率对收益向下波动和向上波动两种情况做出了区分，并认为只有收益向下波动才意味着风险。在实际计算中，我们统一使用基准组合收益为目标收益，作为向上波动和向下波动的判断标准。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;$$
\sigma =\sqrt{\frac{244}{n-1}\sum_{i=1}^{n}{\left[ r_{p}\left( i \right)\; -\; r_{b}(i) \right]^{2} I(i)}}
$$
$$
I(i)=\begin{cases}1 &amp;amp; r_p(i)&amp;lt;r_b(i) \\ 0 &amp;amp; r_p(i) \geq r_b(i)\end{cases}
$$&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;其中，n为回测期内交易日数量；$r_p,r_b$ 分别表示第i个交易日策略所持有投资组合的日收益率、基准组合的日收益率；I(i)为指示函数(indicator function)，如果第i个交易日策略所持有投资组合收益低于基准组合收益，则标记为1（向下波动），否则标记为0（向上波动）。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [15]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;downside_r&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dropna&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;downside_risk&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sqrt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;244&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;day_count&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;downside_r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;downside_r&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;benchmark&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;downside_risk&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[15]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;0.06079720493473829&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
&lt;div class="cell border-box-sizing text_cell rendered"&gt;&lt;div class="prompt input_prompt"&gt;
&lt;/div&gt;
&lt;div class="inner_cell"&gt;
&lt;div class="text_cell_render border-box-sizing rendered_html"&gt;
&lt;h3 id="最大回撤(max-drawdown):"&gt;最大回撤(max drawdown):&lt;a class="anchor-link" href="https://goldengrape.github.io/posts/python/Alpha_tear/#%E6%9C%80%E5%A4%A7%E5%9B%9E%E6%92%A4(max-drawdown):"&gt;¶&lt;/a&gt;&lt;/h3&gt;&lt;blockquote&gt;&lt;p&gt;在回测期内，在任一交易日往后推，策略总权益走到最低点时收益率回撤幅度的最大值。最大回撤是评估策略极端风险管理能力的重要指标。其计算方式如下：
$$
Drawdown_t=\begin{cases}0 &amp;amp; NET_t = min_{j \geq t} NET_j\\\frac{NET_t-min_{j \geq t}NET_j}{NET_t} &amp;amp; ELSE\end{cases}
\\
NET=某期净值
\\
MaxDrawdown=Max(Drawdown_t)
$$&lt;/p&gt;
&lt;/blockquote&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="cell border-box-sizing code_cell rendered"&gt;
&lt;div class="input"&gt;
&lt;div class="prompt input_prompt"&gt;In [16]:&lt;/div&gt;
&lt;div class="inner_cell"&gt;
    &lt;div class="input_area"&gt;
&lt;div class=" highlight hl-ipython3"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;NET&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;p_target&lt;/span&gt;
&lt;span class="n"&gt;NET&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort_index&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ascending&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;inplace&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;NET_min&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;NET&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;date&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;NET&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;NET_min&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NET&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loc&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;min&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
&lt;span class="n"&gt;Drawdown_t&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NET&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;NET_min&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;NET&lt;/span&gt;
&lt;span class="n"&gt;max_Drawdown&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Drawdown_t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;max&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;max_Drawdown_date&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Drawdown_t&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;idxmax&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_Drawdown_date&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;max_Drawdown&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div class="output_wrapper"&gt;
&lt;div class="output"&gt;


&lt;div class="output_area"&gt;

&lt;div class="prompt output_prompt"&gt;Out[16]:&lt;/div&gt;




&lt;div class="output_text output_subarea output_execute_result"&gt;
&lt;pre&gt;(Timestamp('2015-06-08 00:00:00'), 0.44965219768536796)&lt;/pre&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div&gt;
&lt;/div&gt;

&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
</description><category>python</category><guid>https://goldengrape.github.io/posts/python/Alpha_tear/</guid><pubDate>Sat, 22 Sep 2018 17:00:00 GMT</pubDate></item><item><title>自动生成Keynote演讲视频</title><link>https://goldengrape.github.io/posts/bulabula/auto_keynote_presentation/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;h3&gt;目的:&lt;/h3&gt;
&lt;p&gt;用mac上的系统语音, 自动播放keynote幻灯, 并且朗读keynote中的“演讲者备注”, 如果页面中有动画, 就依次播放完动画, 然后再切换到下一页.&lt;/p&gt;
&lt;!-- &lt;iframe width="560" height="315" src="https://www.youtube.com/embed/AOMDt7xrIU4" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen&gt;&lt;/iframe&gt; --&gt;

&lt;h3&gt;使用方法:&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;到这个&lt;a href="https://gist.github.com/goldengrape/eb4359a6467c5196435e469708c95f11"&gt;gist页面&lt;/a&gt;, 点击Download zip, 将代码下载到电脑上, 然后解压缩得到“Simple Play and Say.scpt”文件&lt;/li&gt;
&lt;li&gt;制作好keynote, 保持当前文档打开状态&lt;/li&gt;
&lt;li&gt;双击打开“Simple Play and Say.scpt”文件, 然后运行脚本&lt;/li&gt;
&lt;li&gt;QuickTime Player会自动录制屏幕播放过程. 然后可以保存或者导出成其他分辨率的视频.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这种方式可以快速生成演讲视频, 如果讲稿中有地方需要修改, 只要改动字符就可以了, 不必像对着镜头讲课录像那种必须要重新剪辑或者重新配音.&lt;/p&gt;
&lt;p&gt;而且说个英文什么的也很方便, 只是中文语音目前只有“婷婷”可以用.&lt;/p&gt;
&lt;h3&gt;进阶使用方法:&lt;/h3&gt;
&lt;p&gt;&lt;!-- TEASER_END --&gt;
直接使用QuickTime进行屏幕录像的时候, 默认使用的是“内置麦克风”, 如果环境比较嘈杂, 那么背景音也会录下来.&lt;/p&gt;
&lt;p&gt;解决的方法是让QuickTime进行“内录”, 也就是直接劫持声卡的声音. 有一个很久远的开源软件可以达成这个目的, &lt;a href="https://github.com/mattingalls/Soundflower/releases"&gt;Soundflower&lt;/a&gt;, 点击下载安装以后, 将出现两个新的声卡.&lt;/p&gt;
&lt;p&gt;先打开一次QuickTime Player, 新建屏幕录像, 然后点击录像按钮旁边的展开箭头, 将麦克风设定为Soundflower(2ch)&lt;/p&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-08-26 10.59.06" src="https://i.loli.net/2018/08/26/5b8217b2b8a7e.png"&gt;&lt;/p&gt;
&lt;p&gt;QuickTime里面貌似设定一次以后就默认保持这种设置了.&lt;/p&gt;
&lt;p&gt;然后在运行脚本播放keynote之前, 要将系统的声音输出也设定到Soundflower(2ch)虚拟声卡上. 方法是点击屏幕顶部菜单栏中的音量图标, 就可以直接修改了.&lt;/p&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-08-26 11.02.25" src="https://i.loli.net/2018/08/26/5b821858cc1bf.png"&gt;&lt;/p&gt;
&lt;p&gt;记得在重放的时候, 将声音的输出设备修改会“内置扬声器”, 否则就听不到声音了.&lt;/p&gt;
&lt;h3&gt;代码解释&lt;/h3&gt;
&lt;p&gt;代码修改自Sal Soghoian的&lt;a href="https://iworkautomation.com/keynote/slide-presenter-notes.html"&gt;iwork &amp;amp; automation网站&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;我添加了使用QuickTime进行屏幕录像的几段.&lt;/p&gt;
&lt;p&gt;之前一直无法解决自动播放动画的问题, 经过一上午的尝试(我可真无聊), 终于这样解决了:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;repeat 10 times
    tell document 1
        set cNum to (get slide number of current slide)
    end tell
    if cNum is not equal to i then
        exit repeat
    else
        show next
        say "," -- I really don't know why I have to say something here, english comma is a sound of silence
    end if
end repeat
&lt;/pre&gt;


&lt;p&gt;每个页面内“点击下一个”, 不超过10次, 如果你的动画太多, 可以修改这个数字. 但我建议还不如分成两页幻灯.&lt;/p&gt;
&lt;p&gt;然后去判断现在是不是还在当前页面, 或者已经是切换到了下一张, 如果切换了, 就跳出循环, 如果还在这一页, 就继续“点击下一个”, 但如果仅仅这么写, 就会出现一口气连续点击了10次, 直接跳到结尾了.&lt;/p&gt;
&lt;p&gt;我试过很多方法, 比如delay, do shell script "sleep " 之类, 都无法解决, 后来发现必须用say说点什么, 但又不想让在这里真的说点什么, 于是就说个逗号吧, 也算是某种“Sound of Silence”&lt;/p&gt;&lt;/div&gt;</description><category>applescript</category><category>教程</category><category>现代眼科医生知识扩展包</category><guid>https://goldengrape.github.io/posts/bulabula/auto_keynote_presentation/</guid><pubDate>Sun, 26 Aug 2018 02:00:00 GMT</pubDate></item><item><title>将书法导入成keynote形状</title><link>https://goldengrape.github.io/posts/bulabula/import_calligraphy_to_keynote_as_shape/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;自己写的毛笔字仍然有诸多缺陷, 不过现代人的展示更多发生在幻灯片而不是宣纸上, 比如在做幻灯的时候用上自己写的字, 感觉很开心.&lt;/p&gt;
&lt;p&gt;导入成Keynote形状以后, 多了许多后期调整的可能性. 很有意思.&lt;/p&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-08-22 21.35.52" src="https://i.loli.net/2018/08/23/5b7e2d3ddb6f6.png"&gt;&lt;/p&gt;
&lt;p&gt;先说说如何导入:&lt;/p&gt;
&lt;!-- TEASER_END --&gt;

&lt;ol&gt;
&lt;li&gt;用手机上的&lt;a href="https://www.adobe.com/products/capture.html"&gt;adobe caputre&lt;/a&gt;拍摄, 简单修饰形状. 这个app在android和iOS上都有.&lt;/li&gt;
&lt;li&gt;导出成SVG&lt;/li&gt;
&lt;li&gt;发送到电脑上, 如果是iOS对mac可以很简单使用airdrop.&lt;/li&gt;
&lt;li&gt;下载并安装 &lt;a href="https://www.christianholz.net/keynote_utilities.html#svg2keynote"&gt;SvgToKeynote&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;运行SvgToKeynote将SVG文件转换成keynote文件, 注意转换出来的是早期版本的keynote文件, 编辑或者存储时会提示升级, 升级就好了.&lt;/li&gt;
&lt;li&gt;keynote文件内的图形就是“形状”了, 如果用右键点击可以出现“使可以编辑”, 就可以编辑顶点. 还可以“存储到我的形状”&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Keynote形状, 或者说Keynote shape的好处是可以进行逻辑运算, 能够将两个形状进行融合/ 交叉/ 减少/ 排除, 于是可以比较方便地拆分各个组件.&lt;/p&gt;
&lt;p&gt;在书法, 可以用编辑顶点的方法修改笔画的细节, 比如笔锋, 牵丝。 还可以将各个笔势分离开来, 调整裹束, 也就是间架结构.&lt;/p&gt;
&lt;p&gt;如果有处理SVG的专业软件, 当然直接处理可能会更简单一些.&lt;/p&gt;
&lt;p&gt;对于PowerPoint, 需要升级到office 365以后, 能够有convert to shape功能, 但我买的不是, 所以无法处理SVG.&lt;/p&gt;
&lt;p&gt;对于PowerPoint,  原来有三种“图像”:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;形状: 可以编辑顶点, 可以改变填充颜色, 是矢量图&lt;/li&gt;
&lt;li&gt;图形: 不能编辑顶点, 可以改变填充颜色, 是矢量图&lt;/li&gt;
&lt;li&gt;图片: 不能编辑顶点, 不能改变填充颜色, 是标量图&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其中后两种在keynote里都作为图片处理. 在keynote中, 如果把文件导出成powerpoint文件, 那么形状-&amp;gt;形状, 如果是在keynote中复制, 到powerpoint中粘贴, 是形状-&amp;gt;图片.&lt;/p&gt;
&lt;p&gt;sspai里这一篇&lt;a href="https://sspai.com/post/39238"&gt;文章&lt;/a&gt;说用Libre Office把SVG转换成keynote形状也可以. 不过Libre Office有200多M, 我懒得装了, 如果有一天SvgToKeynote失效了, 记着Libre Office可用.&lt;/p&gt;
&lt;p&gt;如果直接使用书法字典(有很多网站)里面的位图图片, 用inkscape转换成SVG也不错. 而且用inkscape把adobe capture拍摄的SVG化简非常好用.&lt;/p&gt;&lt;/div&gt;</description><category>mac</category><guid>https://goldengrape.github.io/posts/bulabula/import_calligraphy_to_keynote_as_shape/</guid><pubDate>Thu, 23 Aug 2018 04:00:00 GMT</pubDate></item><item><title>区块链儿化音添加方案(建议稿)</title><link>https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;霍炬首先发现&lt;a href="https://twitter.com/virushuo/status/1017977810017632256"&gt;这个问题&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;virushuo: 惊呆了，区块儿链儿这个儿化音在哪竟然是争议问题。。。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;为尽快形成共识&lt;sup id="fnref-0"&gt;&lt;a class="footnote-ref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fn-0"&gt;1&lt;/a&gt;&lt;/sup&gt;, 在此提出
《区块链儿话音添加方案(建议稿)》:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;在互联网大会发言时，应吐词清晰不宜使用儿话音，不慎加入时，注意不可在词尾加入。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;儿话表示物体较小&lt;sup id="fnref-1"&gt;&lt;a class="footnote-ref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fn-1"&gt;2&lt;/a&gt;&lt;/sup&gt;, 为显示本公司参与者众多，链长，可以把儿话音加在块儿上。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;简称时可使用我司的链儿，以表示可作为套在颈上&lt;sup id="fnref-2"&gt;&lt;a class="footnote-ref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fn-2"&gt;3&lt;/a&gt;&lt;/sup&gt;的智能合约，并且可延长。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;作为从业者，不宜使用吞音，例如圈儿链。但应识别出吞音明显的使用者通常是南城五套房的土豪，宜跟进!&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果不适应儿话音，则不要强行添加，必要时可使用block chain的英文，例如对粤语区，可使用波克钦&lt;sup id="fnref-3"&gt;&lt;a class="footnote-ref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fn-3"&gt;4&lt;/a&gt;&lt;/sup&gt;的发音.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn-0"&gt;
&lt;p&gt;&lt;a href="https://twitter.com/shell909090/status/1018004112246337537"&gt;@shell909090说&lt;/a&gt; : 我觉得加哪都好，但是务必要尽快形成共识。只有有了共识，才能产生价值。 &lt;a class="footnote-backref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fnref-0" title="Jump back to footnote 1 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-1"&gt;
&lt;p&gt;以维基百科记录的&lt;a href="https://zh.wikipedia.org/wiki/%E5%85%92%E5%8C%96%E9%9F%B3"&gt;儿化音使用&lt;/a&gt;为例, “有时是否使用一些儿化音难以从道理推断，其中有复杂的历史或音韵原因或者为了和同音字区别，由此也可以用来推测一个人是否本地人。如在北京的城门中，多数如前门、西直门、复兴门等不能儿化，而西便门、广渠门却通常使用儿化。”
&lt;em&gt;其实, 这里面还是有规律可循, 前门, 西直门, 复兴门都是正门, 庄重肃穆, 不可随意儿化, 而“西便门”、“广渠门”则是后开的小门, 小就可能加上儿化音.&lt;/em&gt; &lt;a class="footnote-backref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fnref-1" title="Jump back to footnote 2 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-2"&gt;
&lt;p&gt;参见&lt;a href="https://twitter.com/cxiaoji/status/1017988309283319808"&gt;消极姐推文&lt;/a&gt;:  @cxiaoji说: 只有栓脖子上的才叫链儿 &lt;a class="footnote-backref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fnref-2" title="Jump back to footnote 3 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn-3"&gt;
&lt;p&gt;注意粤式英文词尾务必要使用平声. 单词发音以短促跳跃为佳 &lt;a class="footnote-backref" href="https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/#fnref-3" title="Jump back to footnote 4 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;&lt;/div&gt;</description><guid>https://goldengrape.github.io/posts/bulabula/sound-addition-for-blockchain/</guid><pubDate>Fri, 27 Jul 2018 04:00:00 GMT</pubDate></item><item><title>octopus视野报告数据提取</title><link>https://goldengrape.github.io/posts/python/octopus-data/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;又写好了一段PDF报告数据提取的小程序, 这次是针对Octopus 900动态视野计的. 可以提取PDF的视野检查结果报告中的数据, 能够提取的数据包括: 姓名, 生日, 检查日期, 眼别, 检查程序名称, RF, MS, MD, sLV, 还有视野测量的原始数据. &lt;/p&gt;
&lt;p&gt;提取出来的数据保存在csv文件里, 可以使用excel打开和处理.
&lt;img alt="示例" src="https://i.loli.net/2018/07/09/5b43624ad0d9f.png"&gt;
其中以G standard程序测量的原始数据是按照从中心开始顺时针螺线的方式排列成一行的.
&lt;img alt="屏幕快照 2018-07-08 20.11.26" src="https://i.loli.net/2018/07/09/5b437a3ac6eed.png"&gt;&lt;/p&gt;
&lt;p&gt;也可以处理一个一个文件夹下所有的PDF报告, 把提取的数据汇总到一个csv里面.&lt;/p&gt;
&lt;p&gt;项目文件开源, 放在在&lt;a href="https://github.com/goldengrape/read_medical_device_data/blob/master/python/pdf_parser/Octopus_VF.ipynb"&gt;github&lt;/a&gt;上, 如果已经比较熟悉github, python和jupyter, 打开看看就很容易理解.  &lt;/p&gt;
&lt;p&gt;&lt;em&gt;注意: 目前我还只能处理未加密的PDF, 并且PDF的页面大小必须严格是A4, 否则无法取得数据. 切记切记.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;但如果以前没怎么接触过python, 又临时需要处理些数据, 那么以下是使用教程:
&lt;!-- TEASER_END --&gt;&lt;/p&gt;
&lt;h2&gt;云端运行&lt;/h2&gt;
&lt;p&gt;如果不是写python已经比较熟练的人, 我一般不推荐在本地计算机上安装python和相关的工具包, 很容易出错. 我建议是在云端运行, 可以选择的服务商很多, 但微软的 &lt;a href="https://notebooks.azure.com"&gt;Azure notebook&lt;/a&gt; 免费, 国内可以访问, 还可以运行私有项目以免泄露病人数据, 因此比较推荐.&lt;/p&gt;
&lt;p&gt;1.
打开微软的&lt;a href="https://notebooks.azure.com"&gt;Azure notebook&lt;/a&gt;, 地址是https://notebooks.azure.com , 点击页面右上的Sign In, 使用微软账户登陆, 如果没有微软账户的话, 需要自己注册一个.&lt;/p&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-07-09 21.34.01" src="https://i.loli.net/2018/07/09/5b4364976e694.png"&gt;&lt;/p&gt;
&lt;p&gt;2.
登陆进来以后, 点击左上的Libraries, 将列出您已经建立过的Library, 如果以前没用过, 下面是空的.
&lt;img alt="屏幕快照 2018-07-09 21.36.27" src="https://i.loli.net/2018/07/09/5b43652cc37a4.png"&gt;&lt;/p&gt;
&lt;p&gt;3.
点击 + New Library, 建立一个新的Library.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在选项卡中, 选择From GitHub,&lt;/li&gt;
&lt;li&gt;在GitHub repository里面填上https://github.com/goldengrape/read_medical_device_data&lt;/li&gt;
&lt;li&gt;给自己的Library起个名字, 再起个ID, 比如都叫Octopus&lt;/li&gt;
&lt;li&gt;然后点击Import&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-07-09 21.40.09" src="https://i.loli.net/2018/07/09/5b4365d3b854f.png"&gt;&lt;/p&gt;
&lt;p&gt;4.
稍等, 或者刷新一下页面, 你会看到刚才建立的Library已经出现了, 点击进入.&lt;/p&gt;
&lt;h2&gt;上传数据&lt;/h2&gt;
&lt;p&gt;1.
在上传数据之前, 先把这个Library设定成私有,
&lt;img alt="屏幕快照 2018-07-09 21.46.04" src="https://i.loli.net/2018/07/09/5b4367339bc4b.png"&gt;
点击齿轮⚙️图标&lt;/p&gt;
&lt;p&gt;把Public Library前面的钩去掉, 然后Save
&lt;img alt="屏幕快照 2018-07-09 21.47.41" src="https://i.loli.net/2018/07/09/5b43679c89bac.png"&gt;&lt;/p&gt;
&lt;p&gt;2.
点击加号➕图标, 就在刚才的齿轮⚙️左边.
&lt;img alt="屏幕快照 2018-07-09 21.50.40" src="https://i.loli.net/2018/07/09/5b4368753d62d.png"&gt;
在item type里面选上Folder, 给自己的数据文件夹起个名字, 比如testdata, 然后点击New&lt;/p&gt;
&lt;p&gt;3.
你会发现出现了一个testdata的文件夹, 跟电脑上差不多的操作, 点击进入
&lt;img alt="屏幕快照 2018-07-09 21.53.00" src="https://i.loli.net/2018/07/09/5b4368e5980ac.png"&gt;&lt;/p&gt;
&lt;p&gt;4.
再次点击加号➕图标, 这次选择From Computer
&lt;img alt="屏幕快照 2018-07-09 21.54.22" src="https://i.loli.net/2018/07/09/5b43693e70341.png"&gt;

然后点击Choose files, 会打开本地文件的选择器, 选上要上传的文件.
&lt;img alt="屏幕快照 2018-07-09 21.56.31" src="https://i.loli.net/2018/07/09/5b4369f19e608.png"&gt;
然后upload, 跟发邮件时添加附件的动作没什么区别.
&lt;img alt="屏幕快照 2018-07-09 21.56.55" src="https://i.loli.net/2018/07/09/5b4369f1703ac.png"&gt;&lt;/p&gt;
&lt;h2&gt;设定参数&lt;/h2&gt;
&lt;p&gt;1.
点击Library &amp;gt; Octopus &amp;gt; testdata 中的Octopus, 回到上一级目录
&lt;img alt="屏幕快照 2018-07-09 22.01.53" src="https://i.loli.net/2018/07/09/5b436b2151b69.png"&gt;&lt;/p&gt;
&lt;p&gt;2.
依次进入目录, 到Octopus &amp;gt; python &amp;gt; pdf_parser
&lt;img alt="屏幕快照 2018-07-09 22.04.00" src="https://i.loli.net/2018/07/09/5b436b82038fd.png"&gt;
找到Octopus_VF.ipynb, 点击打开&lt;/p&gt;
&lt;p&gt;3.
打开这个ipynb文件以后, 就进入这样一个页面:
&lt;img alt="屏幕快照 2018-07-09 22.14.14" src="https://i.loli.net/2018/07/09/5b436df1c0a29.png"&gt;
把input_path修改成您刚才设定好的数据文件夹名称, 如果也是使用的testdata, 那就不用修改了.
注意我这里使用的是文件的“相对路径”, ../表示从当前文件夹Octopus &amp;gt; python &amp;gt; pdf_parser退回到上一级Octopus &amp;gt; python, 然后再../退回一级到Octopus, 再进入/testdata.&lt;/p&gt;
&lt;p&gt;output_path可以和input_path一样.&lt;/p&gt;
&lt;p&gt;fname, 如果您需要针对某一个特定文件进行处理, 就把文件名写上, 注意区分大小写, 要带有.pdf的后缀.&lt;/p&gt;
&lt;p&gt;所有的名称都必须在双引号之内.&lt;/p&gt;
&lt;h2&gt;运行&lt;/h2&gt;
&lt;p&gt;1.
把页面一直拖动到最底部,
&lt;img alt="屏幕快照 2018-07-09 22.23.33" src="https://i.loli.net/2018/07/09/5b4370061795e.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果是想处理整个文件夹里所有的PDF文件, 就应该是图中这样的形式,&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;process_folder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;input_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;output_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;save_together&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;save_individual&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;


&lt;ul&gt;
&lt;li&gt;如果想在处理文件夹的同时, 还想把每个PDF文件的数据单独提取成一个csv文件, 就把save_individual=True&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2.
点击顶部菜单中的Kernel, 选择Restart &amp;amp; Run All
&lt;img alt="屏幕快照 2018-07-09 22.26.58" src="https://i.loli.net/2018/07/09/5b4370d34efb6.png"&gt;&lt;/p&gt;
&lt;p&gt;第一次运行的时候会比较慢, 因为用来处理PDF文件的工具包PDFminer.six需要安装. 会看到在import那一堆代码下面出现这样的安装过程, 第二次运行就不会有了.&lt;/p&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-07-09 22.47.41" src="https://i.loli.net/2018/07/09/5b4375b8a9be6.png"&gt;
注意, 免费版本的azure notebook会在没有操作后1小时清空所有用户安装的软件包, 所以, 如果第二天再来, 仍然是“第一次”运行的状态. 但之前保存的数据文件不会被消除.&lt;/p&gt;
&lt;p&gt;3.
处理完成的文件会列出来, 如果有处理不了的PDF文件, 比如页面大小不是A4的, 或者是有密码限制了复制功能的, 都会标记出failed
&lt;img alt="屏幕快照 2018-07-09 22.35.45" src="https://i.loli.net/2018/07/09/5b4372d9d0581.png"&gt;&lt;/p&gt;
&lt;h2&gt;取得结果&lt;/h2&gt;
&lt;p&gt;1.
再次回到Octopus &amp;gt; testdata 文件夹之下,
&lt;img alt="屏幕快照 2018-07-09 22.41.31" src="https://i.loli.net/2018/07/09/5b437454be49f.png"&gt;
会看到octopus_data.csv文件已经生成了, 点击Download下载下来即可.&lt;/p&gt;
&lt;p&gt;2.
excel中的数据, 每一行是一个文件中一页的数据, 因为经常病人是做双眼的检查, 但却放在同一个PDF文件里. 如何处理excel中的数据, 就是您自己的事情了.
&lt;img alt="屏幕快照 2018-07-09 22.46.25" src="https://i.loli.net/2018/07/09/5b43756c49355.png"&gt;&lt;/p&gt;
&lt;h2&gt;其他&lt;/h2&gt;
&lt;p&gt;Octupus自家有数据处理软件, 叫&lt;a href="https://www.haag-streit.com/haag-streit-diagnostics/products/perimetry/eyesuite/"&gt;EyeSuite&lt;/a&gt;, 还有人用R语言做好了一个开源的工具包OPI - &lt;a href="https://people.eng.unimelb.edu.au/aturpin/opi/index.html"&gt;Open Perimetry Initiative&lt;/a&gt;, 比我这个高级多了.&lt;/p&gt;
&lt;p&gt;如果没有这些工具包, 那么用我这个小程序还有点意义, 我抓取了视野检查中的values, 也就是检查时的原始数据, 而不仅仅是MD之类统计好的数据.&lt;/p&gt;
&lt;p&gt;比如示例中的这个病人, 4次检查的MD分别是15.2/ 16.5/ 17/ 16.1, 虽然MD在增加, 但好像又有些波动. 那么视野是否在恶化呢?&lt;/p&gt;
&lt;p&gt;MD是平均缺损, 只能反应整体平均的状态. 由于有了原始数据, 聚可以方便分析每个区域了. 比如很简单而不严格的, 我们可以对这4次检查的数据进行一次线性拟合, 得到的斜率如果是负数, 说明越来越差.&lt;/p&gt;
&lt;p&gt;Excel的线性拟合使用LINEST函数.
&lt;img alt="屏幕快照 2018-07-09 22.57.17" src="https://i.loli.net/2018/07/09/5b43787de7cb2.png"&gt;
拖动复制, 对每列的value值都进行这样的操作.
&lt;img alt="屏幕快照 2018-07-09 22.57.37" src="https://i.loli.net/2018/07/09/5b43787e56617.png"&gt;&lt;/p&gt;
&lt;p&gt;注意看这个区域恶化非常明显, 斜率已经分别是-2,-3,-1.8&lt;/p&gt;
&lt;p&gt;&lt;img alt="屏幕快照 2018-07-09 23.01.49" src="https://i.loli.net/2018/07/09/5b4378fe5ec66.png"&gt;&lt;/p&gt;
&lt;p&gt;实际上这个区域对应的是中央视野附近.
&lt;img alt="屏幕快照 2018-07-09 23.03.44" src="https://i.loli.net/2018/07/09/5b4379841f450.png"&gt;
&lt;img alt="屏幕快照 2018-07-09 23.03.52" src="https://i.loli.net/2018/07/09/5b437982e149a.png"&gt;
&lt;img alt="屏幕快照 2018-07-09 23.04.02" src="https://i.loli.net/2018/07/09/5b43798326b1b.png"&gt;
&lt;img alt="屏幕快照 2018-07-09 23.04.09" src="https://i.loli.net/2018/07/09/5b4379840f876.png"&gt;&lt;/p&gt;
&lt;h2&gt;随机森林&lt;/h2&gt;
&lt;p&gt;作为数据读取项目的一部分, octopus数据处理已经可以纳入到随机森林的机器学习功能之中, 详情请参考&lt;a href="https://goldengrape.github.io/posts/python/random-forest-for-ophthalmology-data/"&gt;眼科数据随机森林&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;更新&lt;/h2&gt;
&lt;p&gt;这是一个业余程序员建立的开源项目, 我水平所限不要要求太高. 但我也还是会不断更新的, 修复bug或者添加新功能.&lt;/p&gt;
&lt;p&gt;如果您已经导入到了azure notebooks里面, 也还是可以更新的. 更新代码的方法, 一种是可以新开一个library, 一种是在本library里更新. 如何新开一个之前已经讲过, 下面讲解一下如何更新.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;点击Terminal 图标
&lt;img alt="屏幕快照 2018-07-10 19.18.22" src="https://i.loli.net/2018/07/10/5b449a27d0f60.png"&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;将打开一个命令行界面.
&lt;img alt="屏幕快照 2018-07-10 19.32.20" src="https://i.loli.net/2018/07/10/5b449a70abf86.png"&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;输入如下命令:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;cd library
&lt;/pre&gt;


&lt;p&gt;进入到library文件夹里
&lt;img alt="屏幕快照 2018-07-10 19.41.22" src="https://i.loli.net/2018/07/10/5b449b67dea1a.png"&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;要更新代码, 需要先把之前您修改过的代码清除掉, 否则有冲突. 输入如下命令:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;git checkout .
&lt;/pre&gt;


&lt;p&gt;&lt;img alt="屏幕快照 2018-07-10 19.44.51" src="https://i.loli.net/2018/07/10/5b449c371555d.png"&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;从github上把新代码“拉”到自己的library里. 输入如下命令:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;git pull
&lt;/pre&gt;


&lt;p&gt;&lt;img alt="屏幕快照 2018-07-10 19.46.31" src="https://i.loli.net/2018/07/10/5b449ca3d43d6.png"&gt;&lt;/p&gt;
&lt;p&gt;这样代码就更新完毕了, 关闭页面即可.&lt;/p&gt;
&lt;p&gt;顺便, 推荐一下git, 如果您的电脑上存了很多“最终版”,“最终不变版本”,“最终最终版本”和“赌咒发誓这是最后一版”之类的文件名, 想必知道版本管理的重要性. git是一个很好的版本管理工具, 以后我会再详细讲解.&lt;/p&gt;
&lt;!-- EOF --&gt;&lt;/div&gt;</description><category>python</category><guid>https://goldengrape.github.io/posts/python/octopus-data/</guid><pubDate>Mon, 09 Jul 2018 13:00:00 GMT</pubDate></item><item><title>显微操作训练(4)</title><link>https://goldengrape.github.io/posts/ophthalmology/microsurgery_4/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;手术显微镜操作训练&lt;/p&gt;
&lt;p&gt;这是一组操作训练作业:
&lt;!-- TEASER_END --&gt;&lt;/p&gt;
&lt;p&gt;1.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;初始化手术显微镜&lt;/li&gt;
&lt;li&gt;设置好显微镜下录像&lt;/li&gt;
&lt;li&gt;用手机或由同伴拍摄坐姿正侧位照片&lt;ul&gt;
&lt;li&gt;在练习0分钟后, 5分钟后, 10分钟后分别拍摄&lt;/li&gt;
&lt;li&gt;或用手机录像拍摄坐姿&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;2.
打印下图
&lt;img alt="幻灯片45" src="https://i.loli.net/2018/07/04/5b3ba3f920315.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;3.
&lt;img alt="幻灯片46" src="https://i.loli.net/2018/07/04/5b3ba4254ca37.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;4.
&lt;img alt="幻灯片47" src="https://i.loli.net/2018/07/04/5b3ba4254ef66.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;5.
&lt;img alt="幻灯片48" src="https://i.loli.net/2018/07/04/5b3ba4254c9e5.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;6.
&lt;img alt="幻灯片49" src="https://i.loli.net/2018/07/04/5b3ba42545a5d.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;7.
&lt;img alt="幻灯片50" src="https://i.loli.net/2018/07/04/5b3ba4254596c.jpeg"&gt;&lt;/p&gt;
&lt;h2&gt;参考资料&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://microsurg.hs.columbia.edu/"&gt;http://microsurg.hs.columbia.edu/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Optical Devices in Ophthalmology and Optometry: technology, Design Principles and Clinical Applications. ISBN: 978-3-527-41068-2 page 147-page 177&lt;/li&gt;
&lt;li&gt;Coursera公开课:&lt;ul&gt;
&lt;li&gt;台湾大学基础光学1,  第6讲
*&lt;a href="https://www.coursera.org/learn/ji-chu-guang-xue"&gt;https://www.coursera.org/learn/ji-chu-guang-xue&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;密歇根大学白内障手术概论, week 2&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.coursera.org/course/cataractsurgery"&gt;https://www.coursera.org/course/cataractsurgery
&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;</description><category>microsurgery</category><category>ophthalmology</category><category>教程</category><guid>https://goldengrape.github.io/posts/ophthalmology/microsurgery_4/</guid><pubDate>Tue, 03 Jul 2018 16:30:00 GMT</pubDate></item><item><title>显微操作训练(3)</title><link>https://goldengrape.github.io/posts/ophthalmology/microsurgery_3/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;前两课讲的是手术之前应当如何调整显微镜, 这一部分讲解在手术中的显微镜使用和操作训练.&lt;/p&gt;
&lt;!-- TEASER_END --&gt;

&lt;h2&gt;正确的坐姿&lt;/h2&gt;
&lt;p&gt;基本的原则是:
&lt;em&gt; 上身的重力不可传导至手
&lt;/em&gt; 全身的重力不可传导至脚&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片22" src="https://i.loli.net/2018/07/03/5b3b803388499.jpeg"&gt;
坐姿应当是可持续的放松舒适动作, 有些坐姿看似很舒服, 或者刚刚开始的时候舒服, 持续一段时间反而会造成很大的损伤.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;术者的上身应当是很挺拔的状态, 自我感觉有点像是头悬梁,&lt;/li&gt;
&lt;li&gt;手肘放松接近90度左右,&lt;/li&gt;
&lt;li&gt;膝盖也是接近90度左右,&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;相应地要调节好凳高和床高.&lt;/p&gt;
&lt;p&gt;双脚分开约60度, 轻放在踏板上.&lt;/p&gt;
&lt;!-- EOF --&gt;

&lt;p&gt;&lt;img alt="幻灯片23" src="https://i.loli.net/2018/07/03/5b3b8194de1c1.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;重复一下坐姿的基本原则是:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;上身的重力不可传导至手&lt;/li&gt;
&lt;li&gt;全身的重力不可传导至脚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这是因为:
肌肉越放松, 动作越敏捷越稳定.&lt;/p&gt;
&lt;p&gt;如果画一张图, 用横轴表示肌张力, 纵轴表示动作的稳定性, 大约是这样的:
&lt;img alt="幻灯片24" src="https://i.loli.net/2018/07/03/5b3b820a7f5d2.jpeg"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;要将肢体放置在指定位置, 显然还是需要一定的肌张力, 不可能为0.&lt;/li&gt;
&lt;li&gt;要达成一定的目标动作, 比如用镊子夹持住囊膜, 也需要有一定的力量. 手术过程中是希望使用能够完成目标动作的最小力量. 比如撕囊, 前囊只有几个微米, 很小的力量即可夹持住, 如果施加更大的力量, 囊膜也仍然只是被夹住而已, 但更大的力量就有可能造成肌肉的抖动, 使稳定性下降.&lt;/li&gt;
&lt;li&gt;如果坐姿出现错误, 手或者脚不但要用力完成动作, 还需要分出一部分力量去支撑身体的重力, 稳定性就会更差.&lt;/li&gt;
&lt;li&gt;如果坐姿更扭曲, 可能还出现肌肉之间互相拮抗, 那时就几乎无法完成任何操作了.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;错误坐姿&lt;/h2&gt;
&lt;p&gt;人在精神高度紧张的时候, 可能不注意自己的坐姿. 或者在上台落座之前, 没有能够很好地调整手术床/手术椅的高度.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片25" src="https://i.loli.net/2018/07/03/5b3b83b1b7fbb.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;要迅速毁掉一台手术非常简单, 比如上图中, 只要手术床摆低一些, 座椅摆到更远离手术床的位置, 脚踏放远一点, 显微镜阻尼放松一点即可.&lt;/p&gt;
&lt;p&gt;分析一下, 在这种情况下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;显微镜阻尼过松, 使用中下垂, 术者要低头, 颈椎压力大&lt;/li&gt;
&lt;li&gt;手术床过低, 工作距离不变, 显微镜必然也要降低, 术者低头弯腰, 颈椎腰椎压力大.&lt;/li&gt;
&lt;li&gt;手术床过低, 手臂下垂+术者低头, 一部分上身重力转移到手腕上, 手腕肌张力提高, 容易出现手抖.&lt;/li&gt;
&lt;li&gt;手术椅太靠后, 术者只坐椅子边缘, 极不稳定, 紧张, 需要动用腿的力量支撑&lt;/li&gt;
&lt;li&gt;脚踏位置太远, 脚需要分担身体重量, 于是踩下脚踏容易, 抬起来却要慢一拍. 如果是发现吸住后囊, 恐怕是松不开了. 而且由于脚移动困难, 就会少移动, 于是会减少显微镜的实时调节, 相应的, 术者眼睛就要自己来动用调节力调节了, 很快也会疲劳.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上述坐姿其实并不罕见, 比如在wetlab实验室中:&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片26" src="https://i.loli.net/2018/07/03/5b3b86e90bebb.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;这位同学就能够把所有上述各项错误都做全了. 还好是在实验室及时发现了她的错误, 并且指出纠正, 现在手术应该是好很多了.&lt;/p&gt;
&lt;p&gt;错误的坐姿不仅威胁病人, 对医生的身体也是损害:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1994年, 面向英国眼科医生问卷调查, 54% 背痛&lt;/li&gt;
&lt;li&gt;2005年, 美国, 52%颈部/上肢/腰痛, 其中15%工作受限制&lt;/li&gt;
&lt;li&gt;2004年, 伊朗, 80%慢性背痛, 55%慢性头痛&lt;/li&gt;
&lt;li&gt;2004年, 美国后节, 55%同时颈部背部痛, 其中7%需要接受手术治疗.
...

Will Ophthalmology Cripple You? http://www.reviewofophthalmology.com/content/i/1650/c/30458/
好好看看, 不要把自己变成别人SCI里的病例.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;显微镜调节&lt;/h2&gt;
&lt;p&gt;显微镜是靠脚踏来调节的. 要熟悉脚踏板的操作. 不同的脚踏可能踏板的定义不同, 需要自己亲自测试一下, 并且要在显微镜上多多练习才能熟悉.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片28" src="https://i.loli.net/2018/07/03/5b3b8990b7fba.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;踏板中最重要的部分就是调节放大率和调焦. 要注意脚踏的各个控制调节都不是无限制的, 都有各自的极限范围, 到达极限以后显微镜有声音却不再移动.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片29" src="https://i.loli.net/2018/07/03/5b3b8a88a0373.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;特别是调焦的微调上下都是有极限的, 经常看到有学生一直踩着脚踏, 显微镜已经降到最低, 仍然抱怨角膜浑浊看不清楚.&lt;/p&gt;
&lt;p&gt;马志中教授讲过: 出现问题, 停下, 恢复到正常状态, 再操作.&lt;/p&gt;
&lt;p&gt;对于显微镜一直调不清楚的实例来说, 就是停下, 看看显微镜是不是已经调到了最低或最高, 如果是, 用复位按钮或者脚踏把显微镜重新放到中间, 再粗调, 再微调.&lt;/p&gt;
&lt;h2&gt;亮度-对比度&lt;/h2&gt;
&lt;p&gt;显微镜的灯很亮, 但并非越亮越好.&lt;/p&gt;
&lt;p&gt;$$
Contrast= \frac{L_{max}-L_{min}}{L_{max}+L_{min}}
$$&lt;/p&gt;
&lt;p&gt;对比度是(最亮-最暗)除以(最亮+最暗), 或者说&lt;/p&gt;
&lt;p&gt;$$
Contrast= \frac{L_{max}-L_{min}}{L_{mean}}
$$&lt;/p&gt;
&lt;p&gt;对比度是(最亮-最暗)除以平均亮度,
提高了照明亮度, 可不一定提高对比度， 因此也不一定“更清楚”
&lt;img alt="幻灯片31" src="https://i.loli.net/2018/07/03/5b3b8ca149c9f.jpeg"&gt;&lt;/p&gt;
&lt;h2&gt;景深 vs 放大率&lt;/h2&gt;
&lt;p&gt;景深: 用手术显微镜时, 在垂直方向上看清楚的范围.
&lt;img alt="幻灯片32" src="https://i.loli.net/2018/07/03/5b3b8ce8d77ab.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;景深和放大率在一定程度上是相反的, 物体放大, 则景深缩小.
&lt;img alt="幻灯片33" src="https://i.loli.net/2018/07/03/5b3b8d576b481.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;由于景深和放大率有矛盾, 所以应当按需分配, 例如&lt;/p&gt;
&lt;h4&gt;在phaco手术中:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;撕囊:&lt;/li&gt;
&lt;li&gt;需要看清囊膜, 所以放大率很重要&lt;/li&gt;
&lt;li&gt;操作仅仅在囊膜平面, 所以景深并不重要.(这个推理仅仅在你不会牵拉切口的前提下, 否则眼球乱转, 囊膜平面倾斜)&lt;/li&gt;
&lt;li&gt;所以, 可以放得大一些&lt;/li&gt;
&lt;li&gt;phaco:&lt;/li&gt;
&lt;li&gt;需要看到从角膜内皮直到后囊膜的范围, 所以景深非常重要.&lt;/li&gt;
&lt;li&gt;核块的相貌倒是并不重要, 所以放大率可以小一些.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;在显微缝合中:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;进针出针: 需要看清细节层次, 可以放大一些&lt;/li&gt;
&lt;li&gt;打结: 针持到镊子的距离可能很大, 需要缩小一些.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;翼状胬肉:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;病人眼动剧烈, 为了减少术者调节, 景深要好一些, 缩小&lt;/li&gt;
&lt;li&gt;病人配合好, 可以适当增加放大率&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;作业:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;看手术时, 记录下不同步骤时主刀所使用的放大率&lt;/li&gt;
&lt;li&gt;记录数字, 显微镜上会有一个旋转的转盘显示数字&lt;/li&gt;
&lt;li&gt;记录镜下视野边缘看到的东西:&lt;ul&gt;
&lt;li&gt;是否可见开睑器&lt;/li&gt;
&lt;li&gt;是否可见睑缘&lt;/li&gt;
&lt;li&gt;是否可见角膜缘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;在显微镜主镜和助手镜下, 分别试试把一支笔插进笔帽里&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;可视范围&lt;/h2&gt;
&lt;p&gt;显微镜有一定的可视范围, 但显然最中央的区域成像质量是最佳的, 要练习将病人的眼睛放在显微镜视野的中央.&lt;/p&gt;
&lt;p&gt;在实验室, 做猪眼练习时, 很多同学在术中把承放猪眼的支架托盘挪来挪去, 甚至旋转! 记住在实际手术中, 病人是不可移动的, 也是不可旋转的. 要用脚踏调位置
&lt;img alt="幻灯片37" src="https://i.loli.net/2018/07/03/5b3b903e142e7.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;另外注意镜下可视范围&amp;gt;录像可视范围, 如果你真的好好录制自己手术, 很可能在前几次手术时, 根本录不到患者的眼球.&lt;/p&gt;
&lt;h2&gt;眼不离镜&lt;/h2&gt;
&lt;p&gt;在手术中, 术者尽量不要使眼睛离开显微镜目镜. 一旦术者的眼睛离开显微镜目镜, 患者眼内不可有任何手术器械!&lt;/p&gt;
&lt;p&gt;如果你眼睛离开目镜去取器械, 左手还留着chopper在患者眼内, 等再回来看时, 恐怕后囊或者虹膜早被钩破了.&lt;/p&gt;
&lt;p&gt;要学会眼睛不离开显微镜就可以传递手术器械.&lt;/p&gt;
&lt;p&gt;很多同学不敢做这个动作, 眼睛不离开显微镜时, 手里拿着器械却找不到. 这是因为人脑总觉得物体是在视线的延长线上, 而显微镜上有反射镜, 所以物体实际比视线所在位置更靠近自己. 练习时, 把器械向自己怀里拉近一些可能就可以找到.
&lt;img alt="幻灯片39" src="https://i.loli.net/2018/07/03/5b3b93335833a.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;人脑有强大的纠错能力, 大约只需要5分钟的简单训练, 就可以习惯眼不离镜取放器械了.&lt;/p&gt;
&lt;p&gt;练习方法也很简单, 找个同伴为你传递器械, 比如一支笔, 眼不离镜, 用笔在镜下往纸上画个点, 然后再递出去. 练习5分钟, 受用一辈子.&lt;/p&gt;
&lt;h2&gt;红反光&lt;/h2&gt;
&lt;p&gt;每一个到我实验室来练习手术的医生我都会问ta是否从病人视角看过手术显微镜的物镜是什么样子, 大约教了300多位医生, 真正看过的人一只手就可以数过来.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片40" src="https://i.loli.net/2018/07/03/5b3b948895ac3.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;这是两种显微镜的物镜照片, 两个小圆就是物镜, 而发亮的是光源的反射镜. 可见光源和物镜并不是在同一个位置.&lt;/p&gt;
&lt;p&gt;所谓眼底红反光, 是显微镜的光源将光投射到眼底, 再反射回来, 被物镜接收到.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片41" src="https://i.loli.net/2018/07/04/5b3b9f68491d5.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;从示意图中可以看出, 如果把眼底简化成一个垂直于眼轴的平面镜, 那么入射角=反射角, 眼轴最多只能在光源和物镜的角平分线之内, 否则反射光就离开物镜了.&lt;/p&gt;
&lt;p&gt;听过科主任对病人喊"看灯"吧, 看灯的时候眼轴指向光源附近, 反射光容易进入物镜, 红反光会比较明显.&lt;/p&gt;
&lt;h2&gt;作业&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;用手机给显微镜底部拍照&lt;/li&gt;
&lt;li&gt;取吸管一根, 底部塞些铝箔&lt;ul&gt;
&lt;li&gt;放在镜下观察反光&lt;/li&gt;
&lt;li&gt;转动角度, 观察反光&lt;/li&gt;
&lt;li&gt;剪成不同长度, 观察反光&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;去验光室学习检影验光&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- EOF  --&gt;&lt;/div&gt;</description><category>microsurgery</category><category>ophthalmology</category><category>教程</category><guid>https://goldengrape.github.io/posts/ophthalmology/microsurgery_3/</guid><pubDate>Tue, 03 Jul 2018 16:00:00 GMT</pubDate></item><item><title>显微操作训练(2)</title><link>https://goldengrape.github.io/posts/ophthalmology/microsurgery_2/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;上一节讲了在手术之前应当对显微镜进行的各种检查, 这一部分讲解在术中需要的各种操作.&lt;/p&gt;
&lt;!-- TEASER_END --&gt;

&lt;h2&gt;清洁区&lt;/h2&gt;
&lt;p&gt;只有套上消毒帽的区域才是清洁区, 术者或者助手可以戴手套操作, 比如:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;调整瞳距&lt;/li&gt;
&lt;li&gt;移动手柄&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其他没有消毒帽覆盖的区域都是污染区, 只有在刷手之前操作或者请巡台护士帮忙&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;屈光度调节&lt;/li&gt;
&lt;li&gt;复位按钮(可能是清洁)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="幻灯片14" src="https://i.loli.net/2018/06/22/5b2bdfbb2707e.jpeg"&gt;&lt;/p&gt;
&lt;h2&gt;初始化&lt;/h2&gt;
&lt;h3&gt;调整手术床高度&lt;/h3&gt;
&lt;p&gt;这个应当在术前完成, 之前已经讲过.&lt;/p&gt;
&lt;h3&gt;显微镜复位&lt;/h3&gt;
&lt;p&gt;显微镜可以通过脚踏来控制调焦(z轴移动)和xy平面上的移动, 但移动范围是有限的, 在手术起始时, 应当赋予显微镜最大的自由选择能力, 也就是能够在各个方向上都有移动的余地, 显微镜应当放置在可移动范围的中央.&lt;/p&gt;
&lt;p&gt;这段话很别扭, 但是"保持最大自由选择能力"是手术中的一个战略原则, 不要把自己逼进死胡同, 否则就处处被动. 这个原则会在撕囊的教学中再次详细解释.&lt;/p&gt;
&lt;p&gt;这个操作是通过复位按钮来实现的.
&lt;img alt="幻灯片16" src="https://i.loli.net/2018/06/22/5b2be454efc53.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;不同的显微镜的复位按钮不同, 不一定都是消毒帽覆盖的, 有可能需要巡台护士帮忙.&lt;/p&gt;
&lt;p&gt;有些显微镜点击了复位按钮之后, xy平面上是复位了, 但在z轴上不一定是自动复位的, 如果没有, 需要用脚踏调焦来将显微镜的z轴指示标记移动到中央.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片17" src="https://i.loli.net/2018/06/22/5b2be8157e8d0.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;所以, 如果到一个新的地方做手术, 要先行了解一下当地的显微镜, 哪怕先随手戳一下复位按钮.&lt;/p&gt;
&lt;h3&gt;瞳距调节&lt;/h3&gt;
&lt;p&gt;眼科医生要熟记自己的瞳距,&lt;/p&gt;
&lt;p&gt;瞳距的调整是通过旋钮,或者,硬掰来完成的, 当然, 如果有旋钮还是使用旋钮. 旋钮上通常有标尺, 也可能是图中右下这样的标尺, 其含义是对齐的线条指示的是瞳距的大小.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片19" src="https://i.loli.net/2018/06/22/5b2be8f10ebe7.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;图中的两个标尺都是表示瞳距=65mm.&lt;/p&gt;
&lt;h3&gt;屈光度调节&lt;/h3&gt;
&lt;p&gt;调节屈光度的旋钮是没有消毒帽保护的, 所以要么上台之前调好, 要么请巡台护士帮忙调整.&lt;/p&gt;
&lt;p&gt;手术显微镜可以裸眼使用, 也可以戴眼镜使用, 如果戴眼镜, 那么相当于正视眼.&lt;/p&gt;
&lt;p&gt;目镜上两个镜筒可以分别调整屈光度,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果是近视使用负向的区域, 例如200度近视, 就应当放在-2,&lt;/li&gt;
&lt;li&gt;如果是远视使用正向的区域.&lt;/li&gt;
&lt;li&gt;如果戴眼镜或者是正视眼, 那么就放在0位置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="幻灯片18" src="https://i.loli.net/2018/06/22/5b2be2d16c940.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;操作之前一定要检查目镜上的屈光度是否合适, 并且调整为自己的参数. 如果前一个手术医生双眼都是近视或远视, 自己又没有重调整参数, 那么在使用时通过调整显微镜整体的焦距是可以看清的, 但这时候助手就看不清了. 又或者, 如果前一位医生有屈光参差, 那如果没有调整, 做手术的时候就好像单眼被打了一拳, 各种别扭而且影响立体感.&lt;/p&gt;
&lt;p&gt;顺便说, 这就是为什么眼科医生很多人自己不做近视手术的原因, 因为做手术的时候用显微镜就可以矫正近视, 不要说近视手术, 连眼镜都可以不要.&lt;/p&gt;
&lt;h3&gt;开灯&lt;/h3&gt;
&lt;p&gt;显微镜灯有两组开关, 一组在显微镜基座上, 是主开关, 当主开关开启以后还可以用脚踏上的开关控制开闭和亮度.&lt;/p&gt;
&lt;h3&gt;粗调焦距&lt;/h3&gt;
&lt;p&gt;&lt;img alt="幻灯片21" src="https://i.loli.net/2018/06/22/5b2beee008ff9.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;开灯后, 手握清洁区域, 移动显微镜.&lt;/p&gt;
&lt;p&gt;有一些显微镜上是有供移动用的手柄或者按钮, 在扳动或者按下时显微镜才能移动.&lt;/p&gt;
&lt;p&gt;将显微镜拉动到病人头部的上空, 然后逐渐下降, 当到达自己眼前时, 凑上去用双眼观察, 继续下降至成像清晰. 然后小心地依次松开双手.&lt;/p&gt;
&lt;p&gt;如果显微镜的阻尼太松, 松手的瞬间显微镜有可能突然下落造成危险, 所以要先松开一只手, 然后再松开一只手, 如果继续下落, 要立即握住显微镜.&lt;/p&gt;
&lt;p&gt;在粗调焦距时,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果处于高放大倍率调清楚了, 那么缩小放大率以后, 显微镜仍然是清晰的. 不必再次调焦&lt;/li&gt;
&lt;li&gt;如果是低倍率时清晰, 当继续放大时, 往往还需要重新调焦.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;其他开关&lt;/h2&gt;
&lt;p&gt;显微镜上还有一些其他的设定开关, 比如&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;调整反射镜位置的红光反射开关,&lt;/li&gt;
&lt;li&gt;保护患者黄斑的阴影开关&lt;/li&gt;
&lt;li&gt;滤光片&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些结构请查阅手术显微镜的说明书. 是的, 显微镜是有说明书的, 放在护士长那里, 去借来看看.&lt;/p&gt;
&lt;h2&gt;作业&lt;/h2&gt;
&lt;p&gt;担任一天显微镜调节员，为每台手术：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;复位显微镜&lt;/li&gt;
&lt;li&gt;询问术者和助手的屈光度和瞳距，并调整&lt;/li&gt;
&lt;li&gt;开、关显微镜灯光，并调整亮度&lt;/li&gt;
&lt;li&gt;借阅手术显微镜说明书&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- EOF --&gt;&lt;/div&gt;</description><category>microsurgery</category><category>ophthalmology</category><category>教程</category><guid>https://goldengrape.github.io/posts/ophthalmology/microsurgery_2/</guid><pubDate>Thu, 21 Jun 2018 18:00:00 GMT</pubDate></item><item><title>显微操作训练(1)</title><link>https://goldengrape.github.io/posts/ophthalmology/microsurgery_1/</link><dc:creator>Golden Grape</dc:creator><description>&lt;div&gt;&lt;p&gt;眼科是一个手术科室, 其中又有大量的手术是在显微镜下完成的, 显微镜下的操作是最重要的基本功之一了.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;良好的习惯产生手术安全,&lt;/li&gt;
&lt;li&gt;正确勤勉的练习产生良好的习惯,&lt;/li&gt;
&lt;li&gt;理解设备的原理和操作的原理指导正确的练习.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面我来简介一下眼科操作显微镜的原理和基本训练. 非本专业同学可以顺便体会一下手术科室的强迫症和碎碎念.
&lt;!-- TEASER_END --&gt;&lt;/p&gt;
&lt;h2&gt;术前设备检查&lt;/h2&gt;
&lt;p&gt;在全天的手术开始之前, 应当亲自检查显微镜. 就好像上战场之前需要检查自己的武器.&lt;/p&gt;
&lt;p&gt;检查的项目有:&lt;/p&gt;
&lt;h3&gt;是否使用了正确的显微镜?&lt;/h3&gt;
&lt;p&gt;显微镜会搭载不同的外设或者本身具有不同的结构, 有些特殊的手术, 是需要特定的显微镜的.&lt;/p&gt;
&lt;p&gt;例如青光眼房角手术, 是使用半球状的房角镜操作, 这时候就需要显微镜的主镜能够倾斜, 但并非所有显微镜都可以做到这点, 术前需要确认.&lt;/p&gt;
&lt;h3&gt;头&lt;/h3&gt;
&lt;p&gt;显微镜是否可以在床头附近自由移动?
&lt;img alt="幻灯片04" src="https://i.loli.net/2018/06/20/5b2a080664c3b.jpeg"&gt;
(图片选自师弟援外时的手术照片, 赞师弟)&lt;/p&gt;
&lt;p&gt;如图中所示, 示意图是俯视图, 红色弧线画出的关节是显微镜的主关节, 要保证这个关节是弯曲的状态.&lt;/p&gt;
&lt;p&gt;从俯视图看, 显微镜是由两个固定臂转动构成, 如果这个关节是完全伸直才能达到患者的头部, 那么再弯曲就够不着了.&lt;/p&gt;
&lt;p&gt;术前要把显微镜挪动到合适的位置, 保持有足够的冗余. 否则术中再移动显微镜底座就非常困难.&lt;/p&gt;
&lt;h3&gt;脚&lt;/h3&gt;
&lt;p&gt;&lt;img alt="幻灯片05" src="https://i.loli.net/2018/06/20/5b2a572576765.jpeg"&gt;
脚踏的位置要在术前事先摆好. 这样术中, 不需要多想脚就可以找到相应的位置.&lt;/p&gt;
&lt;p&gt;多数医院是使用左脚显微镜, 右脚phaco/玻切踏板的设定. 但如果去郑大一附院的时候要小心, 有可能他们的设定相反.&lt;/p&gt;
&lt;p&gt;两个踏板放在与肩同宽或者略宽的位置, 稍微分开成60度左右, 以主刀坐下膝盖90度可舒适踩到踏板为准. 如果太远或太近, 都会造成紧张. 这个后面会详述.&lt;/p&gt;
&lt;h3&gt;床的高度&lt;/h3&gt;
&lt;p&gt;当显微镜座机的位置, 座椅的位置, 脚踏的位置都摆好以后, 相当于在俯视图上把各个物体安顿好了.&lt;/p&gt;
&lt;p&gt;这时候需要调整高度了, 我们转入到侧视图来观察.
&lt;img alt="幻灯片06" src="https://i.loli.net/2018/06/20/5b2a5a3d0ab34.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;从上到下观察, 显微镜的工作距离是不可变的, 虽然显微镜物镜还可以移动, 但距离其实很小. 手术床的厚度给定不可变, 床的高度可调, 凳子的高度可调.&lt;/p&gt;
&lt;p&gt;在操作中凳子的高度要根据术者的小腿长度来设定, 尽量使膝关节弯曲在90度左右. &lt;/p&gt;
&lt;p&gt;显微镜的目镜位置应当在术者平视的位置.&lt;/p&gt;
&lt;p&gt;床的位置需要使术者能够放松放置前臂和手腕, 大约是屈肘90度-120度左右.&lt;/p&gt;
&lt;p&gt;所以综合考虑, 手术床的高度需要有一定的调整, 手术床高了术者的手举高, 容易紧张, 床低了, 可能膝关节活动有影响, 或者手太低也不舒服.&lt;/p&gt;
&lt;p&gt;在准备工作阶段, 术者的舒适感是最优先考虑的事项, 只有术者舒适患者舒适手术才能平稳进行.&lt;/p&gt;
&lt;p&gt;在确定了各个设备的位置之后, 还要检查显微镜的功能&lt;/p&gt;
&lt;h3&gt;显微镜的功能&lt;/h3&gt;
&lt;p&gt;检查显微镜的功能要分别检查主镜和助手镜的功能, 功能检查可以从光/机/电来分类考虑, 不容易漏项.&lt;/p&gt;
&lt;h4&gt;显微镜的光学功能&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;目镜是否插紧是否复位&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;显微镜的目镜是可以拆卸的, 有时候前一个使用者反复调整或者昨天护士在擦拭时目镜可能会松动.&lt;/p&gt;
&lt;p&gt;&lt;img alt="幻灯片08" src="https://i.loli.net/2018/06/20/5b2a5dc96fcf3.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;如果目镜松动, 特别是单个松动, 那样调焦是无论如何无法舒适的. 所以需要确认一下目镜是否塞紧了.&lt;/p&gt;
&lt;p&gt;最好顺手将目镜的屈光度放置到0, 或者设定为第一个术者的屈光度.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;物镜是否太脏&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在眼科手术中, 我们经常需要向患者的角膜上点生理盐水, 偶尔会有少许水滴飞溅到物镜上, 一段时间后水干了会留下盐的痕迹. 会影响成像的对比度, 你不会希望透过一层模糊的镜头来观察前囊的.
&lt;img alt="幻灯片09" src="https://i.loli.net/2018/06/20/5b2a5f5b35c63.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;擦拭物镜需要用擦镜纸, 而不是棉签或者纱布, 用蒸馏水而不是生理盐水.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;助手镜是否打开&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;很多助手镜是可以左右互换的, 如果开关切换到了另一端, 助手镜就是黑的. 刷手之前简单检查一下就好. 如果上台以后才发现有问题, 只好请巡台护士帮忙了, 不但遭到巡台护士的白眼, 而且增加了污染机会.&lt;br&gt;
&lt;img alt="幻灯片10" src="https://i.loli.net/2018/06/20/5b2a60e0e33af.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;注意助手镜的观察角度是可调的, 有一个调节环可以修正角度. 也应当在术前找好与主刀一致的角度, 否则助手操作起来也很困难.&lt;/p&gt;
&lt;p&gt;方法是在镜下放一个物体, 例如一只笔, 按床的长轴方向放置, 然后看着助手镜调整调节环, 使笔的方向合理.&lt;/p&gt;
&lt;p&gt;如果是到一个新的环境, 要弄清楚助手镜的性能, 有的助手镜没有立体感, 放大率不可调, 焦距如何调整要问清楚.&lt;/p&gt;
&lt;h4&gt;机械功能: 悬臂阻尼&lt;/h4&gt;
&lt;p&gt;&lt;img alt="幻灯片11" src="https://i.loli.net/2018/06/20/5b2a61aec1195.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;手术显微镜的悬臂上有多个阻力调节钮, 如果太紧了, 首次调整显微镜位置时很难推动.&lt;/p&gt;
&lt;p&gt;如果阻尼太松了, 显微镜的悬臂可能无法保持位置, 会因为重力缓慢下坠, 术中会发现视物越来越模糊.&lt;/p&gt;
&lt;h4&gt;电器功能:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;照明是否正常&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;试试灯是不是亮的, 想想如果大家都准备好了病人也躺在手术床上才发现灯泡不亮赶着换灯泡的尴尬场面.&lt;/p&gt;
&lt;p&gt;万一术中真的突然灯泡烧了, 每个显微镜常规是有一个可以快速切换的备用灯泡的.
&lt;img alt="幻灯片12" src="https://i.loli.net/2018/06/20/5b2a62eb30c44.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;常规而言灯泡的位置都是在悬臂上有散热格栅的地方, 有一个可以拔出的面板, 里面会有两个灯泡, 旋转180度重新插回就可以启动备用灯泡了. 术后记得要及时换掉烧坏的灯泡.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;录像系统是否接好&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;学习手术必须录像.
学习手术必须录像.
学习手术必须录像.&lt;/p&gt;
&lt;h2&gt;有记录的失败才是成功之母,&lt;/h2&gt;
&lt;h2&gt;没有记录的失败仅仅是场灾难.&lt;/h2&gt;
&lt;h2&gt;作业&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;帮助护士准备和收纳显微镜，认清各种可调整部分。&lt;/li&gt;
&lt;li&gt;学会换灯泡。&lt;/li&gt;
&lt;li&gt;学会使用手术录像设备&lt;/li&gt;
&lt;li&gt;学会调整手术床&lt;/li&gt;
&lt;li&gt;学会助手镜的焦距调节和镜下角度调节&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(未完待续)&lt;/p&gt;&lt;/div&gt;</description><category>microsurgery</category><category>ophthalmology</category><category>教程</category><guid>https://goldengrape.github.io/posts/ophthalmology/microsurgery_1/</guid><pubDate>Wed, 20 Jun 2018 14:00:00 GMT</pubDate></item></channel></rss>