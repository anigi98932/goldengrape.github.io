<p>今天拖延症犯了. 我的拖延症表现是狂做另一件以后可能用到, 但现在无关紧要的事情. 比如加速python的运行速度.</p>
<h1>Numba</h1>
<p><a href="https://numba.pydata.org/">Numba</a>是个很神奇的东西, 加上以后可以提高python的运行速度.
<!-- TEASER_END --></p>
<p>这里有一篇报道翻译, <a href="http://www.infoq.com/cn/news/2017/08/NumPy0-Numba-Python">使用NumPy、Numba和Python异步编程的高性能大数据分析与对比</a></p>
<p>直接看我在自己电脑上测试的结果:</p>
<table>
<thead>
<tr>
<th align="left">行数</th>
<th align="left">numpy</th>
<th>numpy+numba</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">10^7</td>
<td align="left">9.1</td>
<td>1.2秒</td>
</tr>
<tr>
<td align="left">10^8</td>
<td align="left">99.7</td>
<td>4.9秒</td>
</tr>
</tbody>
</table>
<p>报道里还有22. 6分钟对40.2秒的成绩, 我可不会去测试的.</p>
<p>Numba在使用时几乎不用修改代码, 最简单的用法就是在每个函数之前加入@jit的修饰, 这篇报道里就是这么做的. 感觉是免费升级了电脑.</p>
<h1>自动给每个函数加@jit</h1>
<p>但我连给函数加@jit都懒得做, 既然是好像加错了也没有太多的坏处, 那干脆统一给所有的函数都加上这个修饰好了.</p>
<p>所以, 就干脆写了一段代码, 把py文件/ipynb文件当作文本处理, 用正则表达式搜索出所有的函数定义, 在前面加一句@jit好了.</p>
<p>复习了一下正则表达式. 之前写<a href="">&lt;序列一致性检验工具&gt;</a>的时候, 主要练习的是正则表达式中的查找, 这一次练习的是替换.</p>
<p>此处请参考<a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c02/p05_search_and_replace_text.html">Python3 cookbook</a>, 需要小心的一个问题是, 如果用非转译的"\n"来替换字符串的时候, re.sub好像容易把\n给翻译了, 用\n也没有办法. 但用.replace还是可以的. 在处理ipynb文件的时候费了很大周折.</p>
<p>代码在<a href="https://github.com/goldengrape/decorate_with_numba_jit">这里</a></p>
<h1>使用说明</h1>
<ul>
<li>对本路径下所有的py文件添加@jit修饰, 并存入outputpath中</li>
</ul>
<pre class="code literal-block"><span></span><span class="n">python3</span> <span class="n">decorate_with_jit</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">a</span> <span class="n">allpy</span> <span class="n">outputpath</span>
</pre>


<ul>
<li>对本路径下所有的ipynb文件添加@jit修饰, 并存入outputpath中</li>
</ul>
<pre class="code literal-block"><span></span><span class="n">python3</span> <span class="n">decorate_with_jit</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">a</span> <span class="n">allipynb</span> <span class="n">outputpath</span>
</pre>


<ul>
<li>对本路径下所有的py文件去除@jit修饰, 并存入outputpath中</li>
</ul>
<pre class="code literal-block"><span></span><span class="n">python3</span> <span class="n">decorate_with_jit</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">r</span> <span class="n">allpy</span> <span class="n">outputpath</span>
</pre>


<ul>
<li>对本路径下所有的ipynb文件去除@jit修饰, 并存入outputpath中</li>
</ul>
<pre class="code literal-block"><span></span><span class="n">python3</span> <span class="n">decorate_with_jit</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">r</span> <span class="n">allipynb</span> <span class="n">outputpath</span>
</pre>


<ul>
<li>对文件A.py添加@jit修饰, 并保存为文件B.py</li>
</ul>
<pre class="code literal-block"><span></span><span class="n">python3</span> <span class="n">decorate_with_jit</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">a</span> <span class="n">A</span><span class="o">.</span><span class="n">py</span> <span class="n">B</span><span class="o">.</span><span class="n">py</span>
</pre>


<ul>
<li>对文件A.py去除@jit修饰, 并保存为文件B.py</li>
</ul>
<pre class="code literal-block"><span></span><span class="n">python3</span> <span class="n">decorate_with_jit</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">r</span> <span class="n">A</span><span class="o">.</span><span class="n">py</span> <span class="n">B</span><span class="o">.</span><span class="n">py</span>
</pre>


<p>EOF.</p>