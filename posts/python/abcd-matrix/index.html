<!DOCTYPE html>
<html prefix="" lang="zh_cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>ABCD矩阵 | GoldenGrape's Blog</title>
<link href="../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://goldengrape.github.io/posts/python/abcd-matrix/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Golden Grape">
<link rel="prev" href="../../Machine_Learning/ResNet-note/" title="ResNet编写注意事项" type="text/html">
<link rel="next" href="../shi-yong-pythonjin-xing-bei-xie-si-tong-ji-fen-xi/" title="使用python进行贝叶斯统计分析" type="text/html">
<meta property="og:site_name" content="GoldenGrape's Blog">
<meta property="og:title" content="ABCD矩阵">
<meta property="og:url" content="https://goldengrape.github.io/posts/python/abcd-matrix/">
<meta property="og:description" content="光线传输矩阵¶这是一次sympy的小练习.
光线传输矩阵又称做ABCD矩阵 用来描述近轴光线的传播过程.

光线穿过一个光学系统的过程可以用一个2x2的矩阵来表示, 如果:

入射光线距离光轴是x1, 角度是 θ1,  
出射光线距离光轴是x2, 角度是 θ2,

那么: 
$$
\begin{bmatrix}x_2\\ \theta_2 \end{bmatrix} = \begin{bmatri">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-12-29T00:07:03+08:00">
<meta property="article:tag" content="python">
<meta property="article:tag" content="现代眼科医生知识扩展包">
</head>
<body class="theme-base-09">
    <a href="#content" class="sr-only sr-only-focusable">跳到主内容</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            
<!-- DuckDuckGo custom search -->
<form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://goldengrape.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->

        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../index.html">首页</a>
        <a class="sidebar-nav-item" href="../../../archive.html">文章存档</a>
        <a class="sidebar-nav-item" href="../../../categories/">标签</a>
        <a class="sidebar-nav-item" href="../../../categories/jiao-cheng/">教程</a>
        <a class="sidebar-nav-item" href="../../../github-projects/">开源项目</a>
        <a class="sidebar-nav-item" href="../../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://goldengrape.github.io/" title="GoldenGrape's Blog" rel="home">GoldenGrape's Blog</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">ABCD矩阵</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Golden Grape</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2017-12-29T00:07:03+08:00" itemprop="datePublished" title="2017-12-29 00:07">2017-12-29 00:07</time></a></p>
        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="光线传输矩阵">光线传输矩阵<a class="anchor-link" href="#%E5%85%89%E7%BA%BF%E4%BC%A0%E8%BE%93%E7%9F%A9%E9%98%B5">¶</a>
</h2>
<p>这是一次sympy的小练习.</p>
<p>光线传输矩阵又称做<a href="https://en.wikipedia.org/wiki/Ray_transfer_matrix_analysis">ABCD矩阵</a> 用来描述近轴光线的传播过程.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/RayTransferMatrixDefinitions.svg/600px-RayTransferMatrixDefinitions.svg.png" alt=""></p>
<p>光线穿过一个光学系统的过程可以用一个2x2的矩阵来表示, 如果:</p>
<ul>
<li>入射光线距离光轴是x1, 角度是 θ1,  </li>
<li>出射光线距离光轴是x2, 角度是 θ2,</li>
</ul>
<p>那么: 
$$
\begin{bmatrix}x_2\\ \theta_2 \end{bmatrix} = \begin{bmatrix}A &amp; B \\C &amp; D \end{bmatrix} \begin{bmatrix}x_1\\ \theta_1 \end{bmatrix}
$$</p>
<p>对于不同的光学元件, ABCD的取值不同.</p>
<p>下面准备使用python的符号运算库sympy, 进行光路的ABCD矩阵分析. 试图建立一个简化的眼球光路追迹模型. 
<!-- TEASER_END --></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sympy基本">Sympy基本<a class="anchor-link" href="#Sympy%E5%9F%BA%E6%9C%AC">¶</a>
</h2>
<p>sympy是python库, 用于符号计算, 轻量级, 不依赖于其他库. 符号计算就是做类似于
$$
(x+y)^2 = x^2 +2xy+ y^2
$$</p>
<p>试了一下sympy, 看起来还比较容易, 几个要点:</p>
<ul>
<li>要把运算中涉及到的符号先定义好, 例如 <code>x,y = symbols('a b')</code>
</li>
<li>要注意一下大小写, symbols是小写, Matrix是大写, solve是小写</li>
<li>其他没什么了</li>
</ul>
<p>我平时常用的几个函数也不多, 其实在mathematica里面也就常用这些.</p>
<ul>
<li>symbols(字符串), 字符串里面是符号, 注意用空格隔开</li>
<li>expr.subs(字典), 替换, 相当于mathematica里面的expr/.{x-&gt;a}</li>
<li>Matrix(list), 把一个list转换成矩阵, 向量也用这个表示. </li>
<li>solve(expr,x), 求解expr==0时, x的解</li>
<li>simplify(expr), 化简表达式</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ABCD-Matrix">ABCD Matrix<a class="anchor-link" href="#ABCD-Matrix">¶</a>
</h2>
<p>内置上常用的参数字典, 其实最常用的也就是在自由空间内传播, 和在球面上折射, 而这两者可以合并成在球面上折射然后再传播一段距离.</p>
<ul>
<li>在自由空间传播距离为d的矩阵是: 
$$
free\space space\space matrix=\begin{bmatrix} 1 &amp; d \\ 0 &amp; 1 \end{bmatrix}
$$</li>
<li>在球面上折射的矩阵, 如果从n1折射率介质经过半径为R的球面, 折射到n2折射率介质: 
$$
curved\space interface\space matrix=\begin{bmatrix} 1 &amp; 0 \\ \frac{(n_1-n_2)}{R n_2} &amp; \frac{n_1}{n_2} \end{bmatrix}
$$</li>
<li>两者合并是相乘的关系, 注意乘法的顺序, 从右至左应当先经过曲面, 再自由传播: </li>
</ul>
$$
pass\space curved\space interface\space  matrix=
\begin{bmatrix} 1 &amp; d \\ 0 &amp; 1 \end{bmatrix}
\begin{bmatrix} 1 &amp; 0 \\ \frac{(n_1-n_2)}{R n_2} &amp; \frac{n_1}{n_2} \end{bmatrix}
$$
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ABCD</span><span class="p">(</span><span class="n">dictname</span><span class="p">):</span>
    <span class="n">d</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s1">'d n1 n2 R f p'</span><span class="p">)</span>
    <span class="n">abcd_dict</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">'free space'</span><span class="p">:</span>         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">'flat interface'</span><span class="p">:</span>     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n1</span><span class="o">/</span><span class="n">n2</span><span class="p">],</span>
        <span class="s1">'curved interface'</span><span class="p">:</span>   <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="n">n2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">n2</span><span class="p">),</span> <span class="n">n1</span><span class="o">/</span><span class="n">n2</span><span class="p">],</span>
        <span class="s1">'curved mirror'</span><span class="p">:</span>      <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="n">R</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">'Thin lens'</span><span class="p">:</span>          <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s1">'Thin lens in power'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">p</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">abcd_dict</span><span class="p">[</span><span class="n">dictname</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Matrix</span><span class="p">([[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">],[</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">]])</span>

<span class="k">def</span> <span class="nf">free_space</span><span class="p">(</span><span class="n">d_inspace</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">'d'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ABCD</span><span class="p">(</span><span class="s1">'free space'</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">d_inspace</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">curved_interface</span><span class="p">(</span><span class="n">na</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="n">Rx</span><span class="p">):</span>
    <span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s1">'n1 n2 R'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ABCD</span><span class="p">(</span><span class="s1">'curved interface'</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">n1</span><span class="p">,</span><span class="n">na</span><span class="p">),(</span><span class="n">n2</span><span class="p">,</span><span class="n">nb</span><span class="p">),(</span><span class="n">R</span><span class="p">,</span><span class="n">Rx</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">pass_curved_interface</span><span class="p">(</span><span class="n">surface_parameters</span><span class="p">):</span>
    <span class="n">n_from</span><span class="p">,</span><span class="n">n_to</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">p_from</span><span class="p">,</span> <span class="n">p_to</span><span class="o">=</span><span class="n">surface_parameters</span>
    <span class="n">transfer_matrix</span> <span class="o">=</span><span class="n">free_space</span><span class="p">(</span><span class="n">p_to</span><span class="o">-</span><span class="n">p_from</span><span class="p">)</span> <span class="o">*</span> <span class="n">curved_interface</span><span class="p">(</span><span class="n">n_from</span><span class="p">,</span><span class="n">n_to</span><span class="p">,</span><span class="n">R</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transfer_matrix</span>
<span class="k">def</span> <span class="nf">Thin_lens_in_power</span><span class="p">(</span><span class="n">power</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">'p'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ABCD</span><span class="p">(</span><span class="s2">"Thin lens in power"</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">power</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="基础人眼模型">基础人眼模型<a class="anchor-link" href="#%E5%9F%BA%E7%A1%80%E4%BA%BA%E7%9C%BC%E6%A8%A1%E5%9E%8B">¶</a>
</h2>
<h3 id="The-Gullstrand-Schematic-Eye">The Gullstrand Schematic Eye<a class="anchor-link" href="#The-Gullstrand-Schematic-Eye">¶</a>
</h3>
<p>数据来自: AAO 2014版 Basic and Clinical Science Course (BCSC) Section 3: Clinical Optics 
第75页</p>
<ul>
<li>折射率:<div class="highlight"><pre><span></span><span class="n">n_air</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">n_cornea</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.376</span><span class="p">,</span> <span class="mf">1.376</span><span class="p">]</span>
<span class="n">n_humor</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.336</span><span class="p">,</span><span class="mf">1.336</span><span class="p">]</span>
<span class="n">n_vitreous</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.336</span><span class="p">,</span><span class="mf">1.336</span><span class="p">]</span>
<span class="n">n_lens</span><span class="p">:[</span><span class="mf">1.386</span><span class="p">,</span><span class="mf">1.386</span><span class="p">]</span>
<span class="n">n_core_lens</span><span class="p">:[</span><span class="mf">1.406</span><span class="p">,</span><span class="mf">1.406</span><span class="p">]</span>
</pre></div>
</li>
<li>
<p>顶点位置:</p>
<div class="highlight"><pre><span></span><span class="n">p_cornea_Anterior</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p_cornea_Posterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">p_lens_Anterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">]</span>
<span class="n">p_core_lens_Anterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.146</span><span class="p">,</span> <span class="mf">3.8725</span><span class="p">]</span>
<span class="n">p_core_lens_Posterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.565</span><span class="p">,</span> <span class="mf">6.5275</span><span class="p">]</span>
<span class="n">p_lens_Posterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">7.2</span><span class="p">,</span><span class="mf">7.2</span><span class="p">]</span>
<span class="n">p_retina</span><span class="p">:</span> <span class="p">[</span><span class="mf">24.4</span><span class="p">,</span> <span class="mf">24.4</span><span class="p">]</span>
</pre></div>
</li>
<li>
<p>曲率半径:</p>
<div class="highlight"><pre><span></span><span class="n">R_cornea_Anterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">7.7</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">]</span>
<span class="n">R_cornea_Posterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.8</span><span class="p">,</span> <span class="mf">6.8</span><span class="p">]</span>
<span class="n">R_lens_Anterior</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.33</span><span class="p">]</span>
<span class="n">R_core_lens_Anterior</span><span class="p">:</span> <span class="p">[</span><span class="mf">7.911</span><span class="p">,</span> <span class="mf">2.655</span><span class="p">]</span>
<span class="n">R_core_lens_Posterior</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.76</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.655</span><span class="p">]</span>
<span class="n">R_lens_Posterior</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.33</span><span class="p">]</span>
</pre></div>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Gullstrand_Schematic_Eye</span><span class="p">(</span><span class="n">eye_parameters</span><span class="p">):</span>
    
    <span class="c1"># 需要定义成符号</span>
    <span class="n">n_air</span><span class="p">,</span> <span class="n">n_cornea</span><span class="p">,</span><span class="n">n_humor</span><span class="p">,</span> <span class="n">n_vitreous</span><span class="p">,</span> <span class="n">n_lens</span><span class="p">,</span> <span class="n">n_core_lens</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span>
    <span class="s1">'n_air n_cornea n_humor n_vitreous n_lens n_core_lens'</span><span class="p">)</span>
    <span class="n">p_cornea_Anterior</span><span class="p">,</span><span class="n">p_cornea_Posterior</span><span class="p">,</span><span class="n">p_lens_Anterior</span><span class="p">,</span><span class="n">p_core_lens_Anterior</span><span class="p">,</span><span class="n">p_core_lens_Posterior</span><span class="p">,</span><span class="n">p_lens_Posterior</span><span class="p">,</span><span class="n">p_retina</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span>
    <span class="s1">'p_cornea_Anterior p_cornea_Posterior p_lens_Anterior p_core_lens_Anterior p_core_lens_Posterior p_lens_Posterior p_retina'</span><span class="p">)</span>
    <span class="n">R_cornea_Anterior</span><span class="p">,</span><span class="n">R_cornea_Posterior</span><span class="p">,</span><span class="n">R_lens_Anterior</span><span class="p">,</span><span class="n">R_core_lens_Anterior</span><span class="p">,</span><span class="n">R_core_lens_Posterior</span><span class="p">,</span><span class="n">R_lens_Posterior</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span>
    <span class="s1">'R_cornea_Anterior R_cornea_Posterior R_lens_Anterior R_core_lens_Anterior R_core_lens_Posterior R_lens_Posterior'</span><span class="p">)</span>
    
    <span class="c1"># 对各个曲面的参数定义: 入射介质折射率, 出射介质折射率, 曲率半径, 本曲面顶点位置, 下一个曲面顶点位置</span>
    <span class="n">surface</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"cornea_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="n">n_air</span><span class="p">,</span><span class="n">n_cornea</span><span class="p">,</span><span class="n">R_cornea_Anterior</span><span class="p">,</span><span class="n">p_cornea_Anterior</span><span class="p">,</span> <span class="n">p_cornea_Posterior</span><span class="p">],</span>
    <span class="s2">"cornea_Posterior"</span><span class="p">:[</span><span class="n">n_cornea</span><span class="p">,</span><span class="n">n_humor</span><span class="p">,</span><span class="n">R_cornea_Posterior</span><span class="p">,</span><span class="n">p_cornea_Posterior</span><span class="p">,</span><span class="n">p_lens_Anterior</span><span class="p">],</span>
    <span class="s2">"lens_Anterior"</span><span class="p">:[</span><span class="n">n_humor</span><span class="p">,</span><span class="n">n_lens</span><span class="p">,</span><span class="n">R_lens_Anterior</span><span class="p">,</span><span class="n">p_lens_Anterior</span><span class="p">,</span><span class="n">p_core_lens_Anterior</span><span class="p">],</span>
    <span class="s2">"core_lens_Anterior"</span><span class="p">:[</span><span class="n">n_lens</span><span class="p">,</span><span class="n">n_core_lens</span><span class="p">,</span><span class="n">R_core_lens_Anterior</span><span class="p">,</span><span class="n">p_core_lens_Anterior</span><span class="p">,</span> <span class="n">p_core_lens_Posterior</span><span class="p">],</span>
    <span class="s2">"core_lens_Posterior"</span><span class="p">:[</span><span class="n">n_core_lens</span><span class="p">,</span><span class="n">n_lens</span><span class="p">,</span><span class="n">R_core_lens_Posterior</span><span class="p">,</span><span class="n">p_core_lens_Posterior</span><span class="p">,</span><span class="n">p_lens_Posterior</span><span class="p">],</span>
    <span class="s2">"lens_Posterior"</span><span class="p">:[</span><span class="n">n_lens</span><span class="p">,</span><span class="n">n_vitreous</span><span class="p">,</span><span class="n">R_lens_Posterior</span><span class="p">,</span><span class="n">p_lens_Posterior</span><span class="p">,</span><span class="n">p_retina</span><span class="p">],</span>
    <span class="s2">"retina"</span><span class="p">:[</span><span class="n">n_vitreous</span><span class="p">,</span><span class="n">n_vitreous</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">p_retina</span><span class="p">,</span><span class="n">p_retina</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="c1"># 曲面的顺序</span>
    <span class="n">surface_seq</span><span class="o">=</span><span class="p">[</span><span class="s2">"cornea_Anterior"</span><span class="p">,</span><span class="s2">"cornea_Posterior"</span><span class="p">,</span><span class="s2">"lens_Anterior"</span><span class="p">,</span><span class="s2">"core_lens_Anterior"</span><span class="p">,</span>
                <span class="s2">"core_lens_Posterior"</span><span class="p">,</span><span class="s2">"lens_Posterior"</span><span class="p">,</span><span class="s2">"retina"</span><span class="p">]</span>
    
    <span class="c1"># 连乘</span>
    <span class="n">eye_transfer_matrix</span><span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># identity matrix</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surface_seq</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">pass_curved_interface</span><span class="p">(</span><span class="n">surface</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">eye_transfer_matrix</span><span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">eye_transfer_matrix</span>
    
    <span class="k">return</span> <span class="n">eye_transfer_matrix</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">eye_parameters</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gullstrand_Schematic_Eye具体参数">Gullstrand_Schematic_Eye具体参数<a class="anchor-link" href="#Gullstrand_Schematic_Eye%E5%85%B7%E4%BD%93%E5%8F%82%E6%95%B0">¶</a>
</h3>
<p>每个项目有两个参数, 前者是调节放松状态, 后者是最大调节状态</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Gullstrand_Schematic_Eye_parameters</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"n_air"</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">"n_cornea"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.376</span><span class="p">,</span> <span class="mf">1.376</span><span class="p">],</span>
    <span class="s2">"n_humor"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.336</span><span class="p">,</span><span class="mf">1.336</span><span class="p">],</span>
    <span class="s2">"n_vitreous"</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.336</span><span class="p">,</span><span class="mf">1.336</span><span class="p">],</span>
    <span class="s2">"n_lens"</span><span class="p">:[</span><span class="mf">1.386</span><span class="p">,</span><span class="mf">1.386</span><span class="p">],</span>
    <span class="s2">"n_core_lens"</span><span class="p">:[</span><span class="mf">1.406</span><span class="p">,</span><span class="mf">1.406</span><span class="p">],</span>
    <span class="s2">"p_cornea_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">"p_cornea_Posterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="s2">"p_lens_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">],</span>
    <span class="s2">"p_core_lens_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.146</span><span class="p">,</span> <span class="mf">3.8725</span><span class="p">],</span>
    <span class="s2">"p_core_lens_Posterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.565</span><span class="p">,</span> <span class="mf">6.5275</span><span class="p">],</span>
    <span class="s2">"p_lens_Posterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">7.2</span><span class="p">,</span><span class="mf">7.2</span><span class="p">],</span>
    <span class="s2">"p_retina"</span><span class="p">:</span> <span class="p">[</span><span class="mf">24.4</span><span class="p">,</span> <span class="mf">24.4</span><span class="p">],</span>
    <span class="s2">"R_cornea_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">7.7</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">],</span>
    <span class="s2">"R_cornea_Posterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.8</span><span class="p">,</span> <span class="mf">6.8</span><span class="p">],</span>
    <span class="s2">"R_lens_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5.33</span><span class="p">],</span>
    <span class="s2">"R_core_lens_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="mf">7.911</span><span class="p">,</span> <span class="mf">2.655</span><span class="p">],</span>
    <span class="s2">"R_core_lens_Posterior"</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.76</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.655</span><span class="p">],</span>
    <span class="s2">"R_lens_Posterior"</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.33</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="调节状态">调节状态<a class="anchor-link" href="#%E8%B0%83%E8%8A%82%E7%8A%B6%E6%80%81">¶</a>
</h3>
<p>假定调节状态是各个参数的线性变化</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">Accommodation_state</span><span class="p">(</span><span class="n">persentage</span><span class="p">):</span>
    <span class="n">state</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">persentage</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> 
        <span class="nb">zip</span><span class="p">(</span><span class="n">Gullstrand_Schematic_Eye_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="n">Gullstrand_Schematic_Eye_parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())}</span>
    <span class="k">return</span> <span class="n">state</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="测试">测试<a class="anchor-link" href="#%E6%B5%8B%E8%AF%95">¶</a>
</h3>
<p>假定调节状态从0到1, 以0.2变化, 其中调节状态=0是调节放松, 调节状态=1是最大调节状态.</p>
<p>入射光从光轴旁0.1mm,平行于光轴入射.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">input_light</span><span class="o">=</span><span class="n">Matrix</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">Accommodation</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">eye_parameters</span><span class="o">=</span><span class="n">Accommodation_state</span><span class="p">(</span><span class="n">Accommodation</span><span class="p">)</span>
    <span class="n">eye_matrix</span><span class="o">=</span><span class="n">Gullstrand_Schematic_Eye</span><span class="p">(</span><span class="n">eye_parameters</span><span class="p">)</span>
    <span class="n">output_light</span><span class="o">=</span><span class="n">eye_matrix</span><span class="o">*</span><span class="n">input_light</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"视网膜上光点距离光轴的距离是: </span><span class="si">{0}</span><span class="se">\n</span><span class="s2">入射到视网膜上的角度是: </span><span class="si">{1}</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_light</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">output_light</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>视网膜上光点距离光轴的距离是: -0.0000640808134414250
入射到视网膜上的角度是: -0.00438892930222859

视网膜上光点距离光轴的距离是: -0.00244173501856344
入射到视网膜上的角度是: -0.00450936564030494

视网膜上光点距离光轴的距离是: -0.00564544009371146
入射到视网膜上的角度是: -0.00467085240921985

视网膜上光点距离光轴的距离是: -0.0102850608794442
入射到视网膜上的角度是: -0.00490361347080649

视网膜上光点距离光轴的距离是: -0.0178899096062572
入射到视网膜上的角度是: -0.00528324762831792

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="测试求解某个参数">测试求解某个参数<a class="anchor-link" href="#%E6%B5%8B%E8%AF%95%E6%B1%82%E8%A7%A3%E6%9F%90%E4%B8%AA%E5%8F%82%E6%95%B0">¶</a>
</h3>
<p>将各个参数都先赋值, 然后取出要求解的x, 将其设定为symbol, 指定入射光线和出射光线参数后, 就可以求解了. 
由于是使用的符号运算, 所以可以使用solve命令进行求解.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">solve_x_in_focus</span><span class="p">(</span><span class="n">optic_matrix</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="n">parameters</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1"># 因为使用近轴光线假设, 所以并不存在球差, </span>
    <span class="c1"># 所以输入光线平行于光轴都可以汇聚, 于输入光线位置无关</span>
    <span class="n">x_input</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s1">'x_input'</span><span class="p">)</span>
    <span class="n">input_light</span><span class="o">=</span><span class="n">Matrix</span><span class="p">([</span><span class="n">x_input</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">output_light</span><span class="o">=</span><span class="n">optic_matrix</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span><span class="o">*</span><span class="n">input_light</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">output_light</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">symbols</span><span class="p">(</span><span class="n">x</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eye_parameters</span><span class="o">=</span><span class="n">Accommodation_state</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">x</span><span class="o">=</span><span class="s2">"p_retina"</span>
<span class="n">p_retina</span> <span class="o">=</span> <span class="n">solve_x_in_focus</span><span class="p">(</span><span class="n">Gullstrand_Schematic_Eye</span><span class="p">,</span><span class="n">eye_parameters</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"视网膜位置在: </span><span class="si">{0}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">p_retina</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>视网膜位置在: 24.3853994427731
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="戴上眼镜">戴上眼镜<a class="anchor-link" href="#%E6%88%B4%E4%B8%8A%E7%9C%BC%E9%95%9C">¶</a>
</h2>
<p>眼镜认为是薄透镜, 角膜距离眼镜12mm</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># f, d = symbols('f d')</span>
<span class="n">glasses_matrix</span><span class="o">=</span><span class="n">free_space</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="n">ABCD</span><span class="p">(</span><span class="s1">'Thin lens in power'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Gullstrand_Schematic_Eye_wear_glasses</span><span class="p">(</span><span class="n">eye_parameters</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Gullstrand_Schematic_Eye</span><span class="p">(</span><span class="n">eye_parameters</span><span class="p">)</span><span class="o">*</span><span class="n">glasses_matrix</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eye_wear_glasses_parameters</span><span class="o">=</span><span class="n">Accommodation_state</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">eye_wear_glasses_parameters</span><span class="p">[</span><span class="s2">"p_retina"</span><span class="p">]</span><span class="o">=</span><span class="mf">25.6</span>
<span class="n">power</span><span class="o">=</span><span class="n">solve_x_in_focus</span><span class="p">(</span><span class="n">Gullstrand_Schematic_Eye_wear_glasses</span><span class="p">,</span><span class="n">eye_wear_glasses_parameters</span><span class="p">,</span><span class="s1">'p'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"眼镜屈光度=</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">power</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>眼镜屈光度=-3.08997137454269
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="计算人工晶体">计算人工晶体<a class="anchor-link" href="#%E8%AE%A1%E7%AE%97%E4%BA%BA%E5%B7%A5%E6%99%B6%E4%BD%93">¶</a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="人工晶体眼">人工晶体眼<a class="anchor-link" href="#%E4%BA%BA%E5%B7%A5%E6%99%B6%E4%BD%93%E7%9C%BC">¶</a>
</h3>
<p>人工晶体假定为薄透镜, 所在位置为ELP.</p>
<p>待调整, 可能需要把角膜两层合成一个K.</p>
<p>目前结果看起来有点怪异, 一般认为正视眼放入的IOL大约是19-20D, 现在得出的结果有点差得远, 大概什么地方有错误</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">IOL_Eye</span><span class="p">(</span><span class="n">IOL_eye_parameters</span><span class="p">):</span>
    
    <span class="c1"># 需要定义成符号</span>
    <span class="n">n_air</span><span class="p">,</span> <span class="n">n_cornea</span><span class="p">,</span><span class="n">n_humor</span><span class="p">,</span> <span class="n">n_vitreous</span><span class="p">,</span> <span class="n">n_lens</span><span class="p">,</span> <span class="n">n_core_lens</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span>
    <span class="s1">'n_air n_cornea n_humor n_vitreous n_lens n_core_lens'</span><span class="p">)</span>
    <span class="n">p_cornea_Anterior</span><span class="p">,</span><span class="n">p_cornea_Posterior</span><span class="p">,</span><span class="n">p_lens_Anterior</span><span class="p">,</span><span class="n">p_core_lens_Anterior</span><span class="p">,</span><span class="n">p_core_lens_Posterior</span><span class="p">,</span><span class="n">p_lens_Posterior</span><span class="p">,</span><span class="n">p_retina</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span>
    <span class="s1">'p_cornea_Anterior p_cornea_Posterior p_lens_Anterior p_core_lens_Anterior p_core_lens_Posterior p_lens_Posterior p_retina'</span><span class="p">)</span>
    <span class="n">R_cornea_Anterior</span><span class="p">,</span><span class="n">R_cornea_Posterior</span><span class="p">,</span><span class="n">R_lens_Anterior</span><span class="p">,</span><span class="n">R_core_lens_Anterior</span><span class="p">,</span><span class="n">R_core_lens_Posterior</span><span class="p">,</span><span class="n">R_lens_Posterior</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span>
    <span class="s1">'R_cornea_Anterior R_cornea_Posterior R_lens_Anterior R_core_lens_Anterior R_core_lens_Posterior R_lens_Posterior'</span><span class="p">)</span>
    <span class="n">ELP</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s1">'ELP'</span><span class="p">)</span>
    <span class="n">IOL_Power</span><span class="o">=</span><span class="n">symbols</span><span class="p">(</span><span class="s1">'IOL_Power'</span><span class="p">)</span>
    <span class="c1"># 对各个曲面的参数定义: 入射介质折射率, 出射介质折射率, 曲率半径, 本曲面顶点位置, 下一个曲面顶点位置</span>
    <span class="n">surface</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"cornea_Anterior"</span><span class="p">:</span> <span class="p">[</span><span class="n">n_air</span><span class="p">,</span><span class="n">n_cornea</span><span class="p">,</span><span class="n">R_cornea_Anterior</span><span class="p">,</span><span class="n">p_cornea_Anterior</span><span class="p">,</span> <span class="n">p_cornea_Posterior</span><span class="p">],</span>
    <span class="s2">"cornea_Posterior"</span><span class="p">:[</span><span class="n">n_cornea</span><span class="p">,</span><span class="n">n_humor</span><span class="p">,</span><span class="n">R_cornea_Posterior</span><span class="p">,</span><span class="n">p_cornea_Posterior</span><span class="p">,</span><span class="n">ELP</span><span class="p">],</span>
    <span class="p">}</span>
    
    <span class="c1"># 曲面的顺序</span>
    <span class="n">surface_seq</span><span class="o">=</span><span class="p">[</span><span class="s2">"cornea_Anterior"</span><span class="p">,</span><span class="s2">"cornea_Posterior"</span><span class="p">]</span>
    
    <span class="c1"># 连乘</span>
    <span class="n">eye_transfer_matrix</span><span class="o">=</span> <span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># identity matrix</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surface_seq</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">pass_curved_interface</span><span class="p">(</span><span class="n">surface</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
        <span class="n">eye_transfer_matrix</span><span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">eye_transfer_matrix</span>
        
    <span class="c1"># 经过人工晶体</span>
    <span class="c1"># 此处可能有错误, 是否应当代入折射率</span>
    <span class="n">eye_transfer_matrix</span> <span class="o">=</span> <span class="n">Thin_lens_in_power</span><span class="p">(</span><span class="n">IOL_Power</span><span class="o">/</span><span class="n">n_humor</span><span class="p">)</span><span class="o">*</span><span class="n">eye_transfer_matrix</span>
    
    <span class="c1"># 到达视网膜</span>
    <span class="n">eye_transfer_matrix</span> <span class="o">=</span> <span class="n">free_space</span><span class="p">(</span><span class="n">p_retina</span><span class="o">-</span><span class="n">ELP</span><span class="p">)</span><span class="o">*</span><span class="n">eye_transfer_matrix</span>
    
    <span class="k">return</span> <span class="n">eye_transfer_matrix</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">IOL_eye_parameters</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">IOL_eye_parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"n_air"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"n_cornea"</span><span class="p">:</span> <span class="mf">1.376</span><span class="p">,</span>
    <span class="s2">"n_humor"</span><span class="p">:</span> <span class="mf">1.336</span><span class="p">,</span>
    <span class="s2">"n_vitreous"</span><span class="p">:</span> <span class="mf">1.336</span><span class="p">,</span>
    <span class="s2">"p_cornea_Anterior"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">"p_cornea_Posterior"</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="s2">"p_retina"</span><span class="p">:</span> <span class="mf">24.4</span><span class="p">,</span> 
    <span class="s2">"R_cornea_Anterior"</span><span class="p">:</span> <span class="mf">7.7</span><span class="p">,</span>
    <span class="s2">"R_cornea_Posterior"</span><span class="p">:</span> <span class="mf">6.8</span><span class="p">,</span>
    <span class="s2">"ELP"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">"IOL_Power"</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># IOL_eye_parameters['ELP']=symbols('ELP')</span>
<span class="n">x</span><span class="o">=</span><span class="s2">"IOL_Power"</span>
<span class="n">IOL_Power</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">solve_x_in_focus</span><span class="p">(</span><span class="n">IOL_Eye</span><span class="p">,</span><span class="n">IOL_eye_parameters</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"人工晶体度数=: </span><span class="si">{0}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">IOL_Power</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>人工晶体度数=: 15.9734364841675
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

</div>
</div>
</div>

</div>
    </div>
  </div>

    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../../categories/xian-dai-yan-ke-yi-sheng-zhi-shi-kuo-zhan-bao/" rel="tag">现代眼科医生知识扩展包</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../Machine_Learning/ResNet-note/" rel="prev" title="ResNet编写注意事项">上一篇文章</a>
            </li>
            <li class="next">
                <a href="../shi-yong-pythonjin-xing-bei-xie-si-tong-ji-fen-xi/" rel="next" title="使用python进行贝叶斯统计分析">下一篇文章</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><footer id="footer"><p>Contents © 2019         <a href="https://twitter.com/goldengrape">Golden Grape</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113165714-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113165714-1');
</script><script src="../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("zh-cn");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
